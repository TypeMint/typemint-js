(function(){window.FSM={},FSM.Machine=function(){function t(t){this.context=t,this._stateTransitions={},this._stateTransitionsAny={},this._defaultTransition=null,this._initialState=null,this._currentState=null}return t.prototype.addTransition=function(t,e,n,o){return n||(n=e),this._stateTransitions[[t,e]]=[n,o]},t.prototype.addTransitions=function(t,e,n,o){var i,r,s,a;for(n||(n=e),a=[],r=0,s=t.length;s>r;r++)i=t[r],a.push(this.addTransition(i,e,n,o));return a},t.prototype.addTransitionAny=function(t,e,n){return e||(e=t),this._stateTransitionsAny[t]=[e,n]},t.prototype.setDefaultTransition=function(t,e){return this._defaultTransition=[t,e]},t.prototype.getTransition=function(t,e){if(this._stateTransitions[[t,e]])return this._stateTransitions[[t,e]];if(this._stateTransitionsAny[e])return this._stateTransitionsAny[e];if(this._defaultTransition)return this._defaultTransition;throw new Error("Transition is undefined: ("+t+", "+e+")")},t.prototype.getCurrentState=function(){return this._currentState},t.prototype.setInitialState=function(t){return this._initialState=t,this._currentState?void 0:this.reset()},t.prototype.reset=function(){return this._currentState=this._initialState},t.prototype.process=function(t){var e;return e=this.getTransition(t,this._currentState),e[1]&&e[1].call(this.context||(this.context=this),t),this._currentState=e[0]},t}()}).call(this),function(){var t,e,n,o,i,r,s,a,l,u,h,c,d,p,_,m,g,f,C,v,y,E,T,S,b,w=[].slice,M=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};window.HTMLString={},HTMLString.String=function(){function t(t,e){null==e&&(e=!1),this._preserveWhitespace=e,t?(null===HTMLString.String._parser&&(HTMLString.String._parser=new b),this.characters=HTMLString.String._parser.parse(t,this._preserveWhitespace).characters):this.characters=[]}return t._parser=null,t.prototype.isWhitespace=function(){var t,e,n,o;for(o=this.characters,e=0,n=o.length;n>e;e++)if(t=o[e],!t.isWhitespace())return!1;return!0},t.prototype.length=function(){return this.characters.length},t.prototype.preserveWhitespace=function(){return this._preserveWhitespace},t.prototype.capitalize=function(){var t,e;return e=this.copy(),e.length()&&(t=e.characters[0]._c.toUpperCase(),e.characters[0]._c=t),e},t.prototype.charAt=function(t){return this.characters[t].copy()},t.prototype.concat=function(){var t,e,n,o,i,r,s,a,l,u,h,c,d,p,_,m,g;for(s=2<=arguments.length?w.call(arguments,0,l=arguments.length-1):(l=0,[]),n=arguments[l++],"undefined"!=typeof n&&"boolean"!=typeof n&&(s.push(n),n=!0),i=this.copy(),u=0,d=s.length;d>u;u++)if(r=s[u],0!==r.length){if(a=r,"string"==typeof r&&(a=new HTMLString.String(r,this._preserveWhitespace)),n&&i.length())for(e=i.charAt(i.length()-1),o=e.tags(),e.isTag()&&o.shift(),"string"!=typeof r&&(a=a.copy()),m=a.characters,h=0,p=m.length;p>h;h++)t=m[h],t.addTags.apply(t,o);for(g=a.characters,c=0,_=g.length;_>c;c++)t=g[c],i.characters.push(t)}return i},t.prototype.contains=function(t){var e,n,o,i,r,s,a;if("string"==typeof t)return this.text().indexOf(t)>-1;for(o=0;o<=this.length()-t.length();){for(n=!0,a=t.characters,i=r=0,s=a.length;s>r;i=++r)if(e=a[i],!e.eq(this.characters[i+o])){n=!1;break}if(n)return!0;o++}return!1},t.prototype.endsWith=function(t){var e,n,o,i,r,s;if("string"==typeof t)return""===t||this.text().slice(-t.length)===t;for(n=this.characters.slice().reverse(),s=t.characters.slice().reverse(),o=i=0,r=s.length;r>i;o=++i)if(e=s[o],!e.eq(n[o]))return!1;return!0},t.prototype.format=function(){var t,e,n,o,i,r,s;for(e=arguments[0],r=arguments[1],i=3<=arguments.length?w.call(arguments,2):[],0>r&&(r=this.length()+r+1),0>e&&(e=this.length()+e),o=this.copy(),n=s=e;r>=e?r>s:s>r;n=r>=e?++s:--s)t=o.characters[n],t.addTags.apply(t,i);return o},t.prototype.hasTags=function(){var t,e,n,o,i,r,s,a;for(o=2<=arguments.length?w.call(arguments,0,i=arguments.length-1):(i=0,[]),n=arguments[i++],"undefined"!=typeof n&&"boolean"!=typeof n&&(o.push(n),n=!1),e=!1,a=this.characters,r=0,s=a.length;s>r;r++)if(t=a[r],t.hasTags.apply(t,o))e=!0;else if(n)return!1;return e},t.prototype.html=function(){var t,e,n,o,i,r,s,a,l,u,h,c,d,p,_,m,g,f,C,v,y,E,T;for(i="",a=[],r=[],n=[],v=this.characters,u=0,p=v.length;p>u;u++){for(t=v[u],n=[],y=a.slice().reverse(),h=0,_=y.length;_>h;h++)if(s=y[h],n.push(s),!t.hasTags(s)){for(c=0,m=n.length;m>c;c++)e=n[c],i+=e.tail(),a.pop(),r.pop();n=[]}for(E=t._tags,d=0,g=E.length;g>d;d++)l=E[d],-1===r.indexOf(l.head())&&(l.selfClosing()||(o=l.head(),i+=o,a.push(l),r.push(o)));t._tags.length>0&&t._tags[0].selfClosing()&&(i+=t._tags[0].head()),i+=t.c()}for(T=a.reverse(),C=0,f=T.length;f>C;C++)l=T[C],i+=l.tail();return i},t.prototype.indexOf=function(t,e){var n,o,i,r,s,a;if(null==e&&(e=0),0>e&&(e=0),"string"==typeof t)return this.text().indexOf(t,e);for(;e<=this.length()-t.length();){for(o=!0,a=t.characters,i=r=0,s=a.length;s>r;i=++r)if(n=a[i],!n.eq(this.characters[i+e])){o=!1;break}if(o)return e;e++}return-1},t.prototype.insert=function(t,e,n){var o,i,r,s,a,l,u,h,c,d,p,_,m,g,f,C;if(null==n&&(n=!0),i=this.slice(0,t),u=this.slice(t),0>t&&(t=this.length()+t),a=e,"string"==typeof e&&(a=new HTMLString.String(e,this._preserveWhitespace)),n&&t>0)for(r=this.charAt(t-1),s=r.tags(),r.isTag()&&s.shift(),"string"!=typeof e&&(a=a.copy()),g=a.characters,h=0,p=g.length;p>h;h++)o=g[h],o.addTags.apply(o,s);for(l=i,f=a.characters,c=0,_=f.length;_>c;c++)o=f[c],l.characters.push(o);for(C=u.characters,d=0,m=C.length;m>d;d++)o=C[d],l.characters.push(o);return l},t.prototype.lastIndexOf=function(t,e){var n,o,i,r,s,a,l,u,h;if(null==e&&(e=0),0>e&&(e=0),o=this.characters.slice(e).reverse(),e=0,"string"==typeof t){if(!this.contains(t))return-1;for(t=t.split("").reverse();e<=o.length-t.length;){for(i=!0,s=0,r=a=0,u=t.length;u>a;r=++a)if(n=t[r],o[r+e].isTag()&&(s+=1),n!==o[s+r+e].c()){i=!1;break}if(i)return e;e++}return-1}for(t=t.characters.slice().reverse();e<=o.length-t.length;){for(i=!0,r=l=0,h=t.length;h>l;r=++l)if(n=t[r],!n.eq(o[r+e])){i=!1;break}if(i)return e;e++}return-1},t.prototype.optimize=function(){var t,e,n,o,i,r,s,a,l,u,h,c,d,p,_,m,g,f,C,v,y,E,T,S,b,w,M,D,L,I,x,R,A,N,O,H;for(l=[],s=[],i=null,I=this.characters.slice().reverse(),m=0,v=I.length;v>m;m++){for(t=I[m],t._runLengthMap={},t._runLengthMapSize=0,n=[],x=l.slice().reverse(),g=0,y=x.length;y>g;g++)if(a=x[g],n.push(a),!t.hasTags(a)){for(f=0,E=n.length;E>f;f++)e=n[f],l.pop(),s.pop();n=[]}for(R=t._tags,C=0,T=R.length;T>C;C++)_=R[C],-1===s.indexOf(_.head())&&(_.selfClosing()||(l.push(_),s.push(_.head())));for(M=0,S=l.length;S>M;M++)_=l[M],o=_.head(),i?(t._runLengthMap[o]||(t._runLengthMap[o]=[_,0]),d=0,i._runLengthMap[o]&&(d=i._runLengthMap[o][1]),t._runLengthMap[o][1]=d+1):t._runLengthMap[o]=[_,1];i=t}for(h=function(t,e){return e[1]-t[1]},A=this.characters,H=[],D=0,b=A.length;b>D;D++)if(t=A[D],r=t._tags.length,!(r>0&&t._tags[0].selfClosing()&&3>r||2>r)){c=[],N=t._runLengthMap;for(_ in N)u=N[_],c.push(u);for(c.sort(h),O=t._tags.slice(),L=0,w=O.length;w>L;L++)_=O[L],_.selfClosing()||t.removeTags(_);H.push(t.addTags.apply(t,function(){var t,e,n;for(n=[],e=0,t=c.length;t>e;e++)p=c[e],n.push(p[0]);return n}()))}return H},t.prototype.slice=function(t,e){var n,o;return o=new HTMLString.String("",this._preserveWhitespace),o.characters=function(){var o,i,r,s;for(r=this.characters.slice(t,e),s=[],o=0,i=r.length;i>o;o++)n=r[o],s.push(n.copy());return s}.call(this),o},t.prototype.split=function(t,e){var n,o,i,r,s,a,l,u;for(null==t&&(t=""),null==e&&(e=0),s=0,n=0,r=[0];!(e>0&&n>e)&&(i=this.indexOf(t,s),-1!==i&&i!==this.length()-1);)r.push(i),s=i+1;for(r.push(this.length()),a=[],o=l=0,u=r.length-2;u>=0?u>=l:l>=u;o=u>=0?++l:--l)a.push(this.slice(r[o],r[o+1]));return a},t.prototype.startsWith=function(t){var e,n,o,i,r;if("string"==typeof t)return this.text().slice(0,t.length)===t;for(r=t.characters,n=o=0,i=r.length;i>o;n=++o)if(e=r[n],!e.eq(this.characters[n]))return!1;return!0},t.prototype.substr=function(t,e){return 0>=e?new HTMLString.String("",this._preserveWhitespace):(0>t&&(t=this.length()+t),void 0===e&&(e=this.length()-t),this.slice(t,t+e))},t.prototype.substring=function(t,e){return void 0===e&&(e=this.length()),this.slice(t,e)},t.prototype.text=function(){var t,e,n,o,i;for(e="",i=this.characters,n=0,o=i.length;o>n;n++)t=i[n],t.isTag()?t.isTag("br")&&(e+="\n"):("&nbsp;"!==t.c(),e+=t.c());return this.constructor.decode(e)},t.prototype.toLowerCase=function(){var t,e,n,o,i;for(e=this.copy(),i=e.characters,n=0,o=i.length;o>n;n++)t=i[n],1===t._c.length&&(t._c=t._c.toLowerCase());return e},t.prototype.toUpperCase=function(){var t,e,n,o,i;for(e=this.copy(),i=e.characters,n=0,o=i.length;o>n;n++)t=i[n],1===t._c.length&&(t._c=t._c.toUpperCase());return e},t.prototype.trim=function(){var t,e,n,o,i,r,s,a,l,u;for(l=this.characters,e=i=0,s=l.length;s>i&&(t=l[e],t.isWhitespace());e=++i);for(u=this.characters.slice().reverse(),o=r=0,a=u.length;a>r&&(t=u[o],t.isWhitespace());o=++r);return o=this.length()-o-1,n=new HTMLString.String("",this._preserveWhitespace),n.characters=function(){var n,i,r,s;for(r=this.characters.slice(e,+o+1||9e9),s=[],n=0,i=r.length;i>n;n++)t=r[n],s.push(t.copy());return s}.call(this),n},t.prototype.trimLeft=function(){var t,e,n,o,i,r,s;for(o=this.length()-1,s=this.characters,e=i=0,r=s.length;r>i&&(t=s[e],t.isWhitespace());e=++i);return n=new HTMLString.String("",this._preserveWhitespace),n.characters=function(){var n,i,r,s;for(r=this.characters.slice(e,+o+1||9e9),s=[],n=0,i=r.length;i>n;n++)t=r[n],s.push(t.copy());return s}.call(this),n},t.prototype.trimRight=function(){var t,e,n,o,i,r,s;for(e=0,s=this.characters.slice().reverse(),o=i=0,r=s.length;r>i&&(t=s[o],t.isWhitespace());o=++i);return o=this.length()-o-1,n=new HTMLString.String("",this._preserveWhitespace),n.characters=function(){var n,i,r,s;for(r=this.characters.slice(e,+o+1||9e9),s=[],n=0,i=r.length;i>n;n++)t=r[n],s.push(t.copy());return s}.call(this),n},t.prototype.unformat=function(){var t,e,n,o,i,r,s;for(e=arguments[0],r=arguments[1],i=3<=arguments.length?w.call(arguments,2):[],0>r&&(r=this.length()+r+1),0>e&&(e=this.length()+e),o=this.copy(),n=s=e;r>=e?r>s:s>r;n=r>=e?++s:--s)t=o.characters[n],t.removeTags.apply(t,i);return o},t.prototype.copy=function(){var t,e;return e=new HTMLString.String("",this._preserveWhitespace),e.characters=function(){var e,n,o,i;for(o=this.characters,i=[],e=0,n=o.length;n>e;e++)t=o[e],i.push(t.copy());return i}.call(this),e},t.encode=function(t){var e;return e=document.createElement("textarea"),e.textContent=t,e.innerHTML},t.decode=function(t){var e;return e=document.createElement("textarea"),e.innerHTML=t,e.textContent},t}(),t="AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz-_$".split(""),e=t.concat("1234567890".split("")),a=e.concat([":"]),g=e.concat(["#"]),v=e.concat([":"]),p=1,m=2,C=3,f=4,_=5,T=6,y=7,S=8,E=9,u=10,s=11,l=12,n=13,d=14,h=15,c=16,i=17,r=18,o=19,b=function(){function b(){this.fsm=new FSM.Machine(this),this.fsm.setInitialState(p),this.fsm.addTransitionAny(p,null,function(t){return this._pushChar(t)}),this.fsm.addTransition("<",p,C),this.fsm.addTransition("&",p,m),this.fsm.addTransitions(g,m,null,function(t){return this.entity+=t}),this.fsm.addTransition(";",m,p,function(){return this._pushChar("&"+this.entity+";"),this.entity=""}),this.fsm.addTransitions([" ","\n"],C),this.fsm.addTransitions(t,C,f,function(){return this._back()}),this.fsm.addTransition("/",C,_),this.fsm.addTransitions([" ","\n"],f),this.fsm.addTransitions(t,f,T,function(){return this._back()}),this.fsm.addTransitions([" ","\n"],_),this.fsm.addTransitions(t,_,y,function(){return this._back()}),this.fsm.addTransitions(v,T,null,function(t){return this.tagName+=t}),this.fsm.addTransitions([" ","\n"],T,u),this.fsm.addTransition("/",T,S,function(){return this.selfClosing=!0}),this.fsm.addTransition(">",T,p,function(){return this._pushTag()}),this.fsm.addTransitions([" ","\n"],S),this.fsm.addTransition(">",S,p,function(){return this._pushTag()}),this.fsm.addTransitions([" ","\n"],u),this.fsm.addTransition("/",u,S,function(){return this.selfClosing=!0}),this.fsm.addTransition(">",u,p,function(){return this._pushTag()}),this.fsm.addTransitions(t,u,s,function(){return this._back()}),this.fsm.addTransitions(v,y,null,function(t){return this.tagName+=t}),this.fsm.addTransitions([" ","\n"],y,E),this.fsm.addTransition(">",y,p,function(){return this._popTag()}),this.fsm.addTransitions([" ","\n"],E),this.fsm.addTransition(">",E,p,function(){return this._popTag()}),this.fsm.addTransitions(a,s,null,function(t){return this.attributeName+=t}),this.fsm.addTransitions([" ","\n"],s,l),this.fsm.addTransition("=",s,n),this.fsm.addTransitions([" ","\n"],l),this.fsm.addTransition("=",l,n),this.fsm.addTransitions(">",s,u,function(){return this._pushAttribute(),this._back()}),this.fsm.addTransitionAny(l,u,function(){return this._pushAttribute(),this._back()}),this.fsm.addTransitions([" ","\n"],n),this.fsm.addTransition("'",n,d),this.fsm.addTransition('"',n,h),this.fsm.addTransitions(e.concat(["&"],n,c,function(){return this._back()})),this.fsm.addTransition(" ",c,u,function(){return this._pushAttribute()}),this.fsm.addTransitions(["/",">"],c,u,function(){return this._back(),this._pushAttribute()}),this.fsm.addTransition("&",c,i),this.fsm.addTransitionAny(c,null,function(t){return this.attributeValue+=t}),this.fsm.addTransition("'",d,u,function(){return this._pushAttribute()}),this.fsm.addTransition("&",d,r),this.fsm.addTransitionAny(d,null,function(t){return this.attributeValue+=t}),this.fsm.addTransition('"',h,u,function(){return this._pushAttribute()}),this.fsm.addTransition("&",h,o),this.fsm.addTransitionAny(h,null,function(t){return this.attributeValue+=t}),this.fsm.addTransitions(g,i,null,function(t){return this.entity+=t}),this.fsm.addTransitions(g,r,function(t){return this.entity+=t}),this.fsm.addTransitions(g,o,null,function(t){return this.entity+=t}),this.fsm.addTransition(";",i,c,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""}),this.fsm.addTransition(";",r,d,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""}),this.fsm.addTransition(";",o,h,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""})}return b.prototype._back=function(){return this.head--},b.prototype._pushAttribute=function(){return this.attributes[this.attributeName]=this.attributeValue,this.attributeName="",this.attributeValue=""},b.prototype._pushChar=function(t){var e,n;return e=new HTMLString.Character(t,this.tags),this._preserveWhitespace?void this.string.characters.push(e):!this.string.length()||e.isTag()||e.isEntity()||!e.isWhitespace()||(n=this.string.characters[this.string.length()-1],!n.isWhitespace()||n.isTag()||n.isEntity())?this.string.characters.push(e):void 0},b.prototype._pushTag=function(){var t,e;return t=new HTMLString.Tag(this.tagName,this.attributes),this.tags.push(t),t.selfClosing()&&(this._pushChar(""),this.tags.pop(),!this.selfClosed&&(e=this.tagName,M.call(HTMLString.Tag.SELF_CLOSING,e)>=0)&&this.fsm.reset()),this.tagName="",this.selfClosed=!1,this.attributes={}},b.prototype._popTag=function(){for(var t,e;e=this.tags.pop(),this.string.length()&&(t=this.string.characters[this.string.length()-1],t.isTag()||t.isEntity()||!t.isWhitespace()||t.removeTags(e)),e.name()!==this.tagName.toLowerCase(););return this.tagName=""},b.prototype.parse=function(t,e){var n,o;for(this._preserveWhitespace=e,this.reset(),t=this.preprocess(t),this.fsm.parser=this;this.head<t.length;){n=t[this.head];try{this.fsm.process(n)}catch(i){throw o=i,new Error("Error at char "+this.head+" >> "+o)}this.head++}return this.string},b.prototype.preprocess=function(t){return t=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),t=t.replace(/<!--[\s\S]*?-->/g,""),this._preserveWhitespace||(t=t.replace(/\s+/g," ")),t},b.prototype.reset=function(){return this.fsm.reset(),this.head=0,this.string=new HTMLString.String,this.entity="",this.tags=[],this.tagName="",this.selfClosing=!1,this.attributes={},this.attributeName="",this.attributeValue=""},b}(),HTMLString.Tag=function(){function t(t,e){var n,o;this._name=t.toLowerCase(),this._selfClosing=HTMLString.Tag.SELF_CLOSING[this._name]===!0,this._head=null,this._attributes={};for(n in e)o=e[n],this._attributes[n]=o}return t.SELF_CLOSING={area:!0,base:!0,br:!0,hr:!0,img:!0,input:!0,"link meta":!0,wbr:!0},t.prototype.head=function(){var t,e,n,o;if(!this._head){t=[],o=this._attributes;for(e in o)n=o[e],t.push(n?""+e+'="'+n+'"':""+e);t.sort(),t.unshift(this._name),this._head="<"+t.join(" ")+">"}return this._head},t.prototype.name=function(){return this._name},t.prototype.selfClosing=function(){return this._selfClosing},t.prototype.tail=function(){return this._selfClosing?"":"</"+this._name+">"},t.prototype.attr=function(t,e){return void 0===e?this._attributes[t]:(this._attributes[t]=e,this._head=null)},t.prototype.removeAttr=function(t){return void 0!==this._attributes[t]?delete this._attributes[t]:void 0},t.prototype.copy=function(){return new HTMLString.Tag(this._name,this._attributes)},t}(),HTMLString.Character=function(){function t(t,e){this._c=t,t.length>1&&(this._c=t.toLowerCase()),this._tags=[],this.addTags.apply(this,e)}return t.prototype.c=function(){return this._c},t.prototype.isEntity=function(){return this._c.length>1},t.prototype.isTag=function(t){return 0!==this._tags.length&&this._tags[0].selfClosing()?t&&this._tags[0].name()!==t?!1:!0:!1},t.prototype.isWhitespace=function(){var t;return" "===(t=this._c)||"\n"===t||"&nbsp;"===t||this.isTag("br")},t.prototype.tags=function(){var t;return function(){var e,n,o,i;for(o=this._tags,i=[],e=0,n=o.length;n>e;e++)t=o[e],i.push(t.copy());return i}.call(this)},t.prototype.addTags=function(){var t,e,n,o,i;for(e=1<=arguments.length?w.call(arguments,0):[],i=[],n=0,o=e.length;o>n;n++)t=e[n],t.selfClosing()?this.isTag()||this._tags.unshift(t.copy()):i.push(this._tags.push(t.copy()));return i},t.prototype.eq=function(t){var e,n,o,i,r,s,a,l;if(this.c()!==t.c())return!1;if(this._tags.length!==t._tags.length)return!1;for(n={},a=this._tags,o=0,r=a.length;r>o;o++)e=a[o],n[e.head()]=!0;for(l=t._tags,i=0,s=l.length;s>i;i++)if(e=l[i],!n[e.head()])return!1;return!0},t.prototype.hasTags=function(){var t,e,n,o,i,r,s,a,l;for(o=1<=arguments.length?w.call(arguments,0):[],n={},e={},l=this._tags,i=0,s=l.length;s>i;i++)t=l[i],n[t.name()]=!0,e[t.head()]=!0;for(r=0,a=o.length;a>r;r++)if(t=o[r],"string"==typeof t){if(void 0===n[t])return!1}else if(void 0===e[t.head()])return!1;return!0},t.prototype.removeTags=function(){var t,e,n,o,i,r,s;if(i=1<=arguments.length?w.call(arguments,0):[],0===i.length)return void(this._tags=[]);for(e={},t={},r=0,s=i.length;s>r;r++)o=i[r],"string"==typeof o?e[o]=o:t[o.head()]=o;return n=[],this._tags=this._tags.filter(function(n){return t[n.head()]||e[n.name()]?void 0:n})},t.prototype.copy=function(){var t;return new HTMLString.Character(this._c,function(){var e,n,o,i;for(o=this._tags,i=[],e=0,n=o.length;n>e;e++)t=o[e],i.push(t.copy());return i}.call(this))},t}()}.call(this),function(){var t,e,n,o,i,r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};window.ContentSelect={},ContentSelect.Range=function(){function r(t,e){this.set(t,e)}return r.prototype.isCollapsed=function(){return this._from===this._to},r.prototype.span=function(){return this._to-this._from},r.prototype.collapse=function(){return this._to=this._from},r.prototype.eq=function(t){return this.get()[0]===t.get()[0]&&this.get()[1]===t.get()[1]},r.prototype.get=function(){return[this._from,this._to]},r.prototype.select=function(t){var e,o,i,r,s,a,l,u,h;return ContentSelect.Range.unselectAll(),e=document.createRange(),u=n(t,this._from),s=u[0],l=u[1],h=n(t,this._to),o=h[0],r=h[1],a=s.length||0,i=o.length||0,e.setStart(s,Math.min(l,a)),e.setEnd(o,Math.min(r,i)),window.getSelection().addRange(e)},r.prototype.set=function(t,e){return t=Math.max(0,t),e=Math.max(0,e),this._from=Math.min(t,e),this._to=Math.max(t,e)},r.prepareElement=function(e){var n,o,i,r,s,a;for(i=e.querySelectorAll(t.join(", ")),a=[],n=r=0,s=i.length;s>r;n=++r)o=i[n],o.parentNode.insertBefore(document.createTextNode(""),o),a.push(n<i.length-1?o.parentNode.insertBefore(document.createTextNode(""),o.nextSibling):void 0);return a},r.query=function(t){var n,r,s,a,l,u,h;a=new ContentSelect.Range(0,0);try{n=window.getSelection().getRangeAt(0)}catch(c){return a}return null===t.firstChild&&null===t.lastChild?a:e(n.startContainer,t)&&e(n.endContainer,t)?(h=o(t,n),l=h[0],u=h[1],r=h[2],s=h[3],a.set(i(t,l)+u,i(t,r)+s),a):a},r.rect=function(){var t,e,n;try{t=window.getSelection().getRangeAt(0)}catch(o){return null}return t.collapsed?(e=document.createElement("span"),t.insertNode(e),n=e.getBoundingClientRect(),e.parentNode.removeChild(e),n):t.getBoundingClientRect()},r.unselectAll=function(){return window.getSelection()?window.getSelection().removeAllRanges():void 0},r}(),t=["br","img","input"],e=function(t,e){for(;t;){if(t===e)return!0;t=t.parentNode}return!1},n=function(e,n){var o,i,s,a,l;if(0===e.childNodes.length)return[e,n];for(o=null,i=n,s=function(){var t,n,o,i;for(o=e.childNodes,i=[],t=0,n=o.length;n>t;t++)a=o[t],i.push(a);return i}();s.length>0;)switch(o=s.shift(),o.nodeType){case Node.TEXT_NODE:if(o.textContent.length>=i)return[o,i];i-=o.textContent.length;break;case Node.ELEMENT_NODE:if(l=o.nodeName.toLowerCase(),r.call(t,l)>=0){if(0===i)return[o,0];i=Math.max(0,i-1)}else o.childNodes&&Array.prototype.unshift.apply(s,function(){var t,e,n,i;for(n=o.childNodes,i=[],t=0,e=n.length;e>t;t++)a=n[t],i.push(a);return i}())}return[o,i]},i=function(e,n){var o,i,s,a,l,u;if(0===e.childNodes.length)return 0;for(s=0,o=function(){var t,n,o,r;for(o=e.childNodes,r=[],t=0,n=o.length;n>t;t++)i=o[t],r.push(i);return r}();o.length>0;){if(a=o.shift(),a===n)return l=a.nodeName.toLowerCase(),r.call(t,l)>=0?s+1:s;switch(a.nodeType){case Node.TEXT_NODE:s+=a.textContent.length;break;case Node.ELEMENT_NODE:u=a.nodeName.toLowerCase(),r.call(t,u)>=0?s+=1:a.childNodes&&Array.prototype.unshift.apply(o,function(){var t,e,n,o;for(n=a.childNodes,o=[],t=0,e=n.length;e>t;t++)i=n[t],o.push(i);return o}())}}return s},o=function(e,n){var o,i,s,a,l,u,h,c,d,p,_,m,g,f;if(i=e.childNodes,d=n.cloneRange(),d.collapse(!0),l=n.cloneRange(),l.collapse(!1),h=d.startContainer,c=d.startOffset,s=l.endContainer,a=l.endOffset,!d.comparePoint)return[h,c,s,a];if(h===e)for(h=i[i.length-1],c=h.textContent.length,u=p=0,m=i.length;m>p;u=++p)if(o=i[u],1===d.comparePoint(o,0)){0===u?(h=o,c=0):(h=i[u-1],c=o.textContent.length),f=h.nodeName.toLowerCase,r.call(t,f)>=0&&(c=1);break}if(n.collapsed)return[h,c,h,c];if(s===e)for(s=i[i.length-1],a=s.textContent.length,u=_=0,g=i.length;g>_;u=++_)o=i[u],1===l.comparePoint(o,0)&&(s=0===u?o:i[u-1],a=o.textContent.length+1);return[h,c,s,a]}}.call(this),function(){var t,e,n,o=[].slice,i=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},r={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a=function(t,e){return function(){return t.apply(e,arguments)}};window.ContentEdit={DEFAULT_MAX_ELEMENT_WIDTH:800,DEFAULT_MIN_ELEMENT_WIDTH:80,DRAG_HOLD_DURATION:500,DROP_EDGE_SIZE:50,HELPER_CHAR_LIMIT:250,INDENT:"    ",LANGUAGE:"en",RESIZE_CORNER_SIZE:15,_translations:{},_:function(t){var e;return e=ContentEdit.LANGUAGE,ContentEdit._translations[e]&&ContentEdit._translations[e][t]?ContentEdit._translations[e][t]:t},addTranslations:function(t,e){return ContentEdit._translations[t]=e},addCSSClass:function(t,e){var n,o,i;return t.classList?void t.classList.add(e):(o=t.getAttribute("class"),o?(i=function(){var t,e,i,r;for(i=o.split(" "),r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(n);return r}(),-1===i.indexOf(e)?t.setAttribute("class",""+o+" "+e):void 0):t.setAttribute("class",e))},attributesToString:function(t){var e,n,o,i,r,s;if(!t)return"";for(o=function(){var e;e=[];for(n in t)e.push(n);return e}(),o.sort(),e=[],r=0,s=o.length;s>r;r++)n=o[r],i=t[n],""===i?e.push(n):(i=HTMLString.String.encode(i),i=i.replace(/"/g,"&quot;"),e.push(""+n+'="'+i+'"'));return e.join(" ")},removeCSSClass:function(t,e){var n,o,i,r;return t.classList?(t.classList.remove(e),void(0===t.classList.length&&t.removeAttribute("class"))):(o=t.getAttribute("class"),o&&(r=function(){var t,e,i,r;for(i=o.split(" "),r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(n);return r}(),i=r.indexOf(e),i>-1)?(r.splice(i,1),r.length?t.setAttribute("class",r.join(" ")):t.removeAttribute("class")):void 0)}},e=function(){function t(){this._tagNames={}}return t.prototype.register=function(){var t,e,n,i,r,s;for(t=arguments[0],n=2<=arguments.length?o.call(arguments,1):[],s=[],i=0,r=n.length;r>i;i++)e=n[i],s.push(this._tagNames[e.toLowerCase()]=t);return s},t.prototype.match=function(t){return this._tagNames[t.toLowerCase()]?this._tagNames[t.toLowerCase()]:ContentEdit.Static},t}(),ContentEdit.TagNames=function(){function t(){}var n;return n=null,t.get=function(){return null!=n?n:n=new e},t}(),ContentEdit.Node=function(){function t(){this._bindings={},this._parent=null,this._modified=null}return t.prototype.lastModified=function(){return this._modified},t.prototype.parent=function(){return this._parent},t.prototype.parents=function(){var t,e;for(e=[],t=this._parent;t;)e.push(t),t=t._parent;return e},t.prototype.type=function(){return"Node"},t.prototype.html=function(t){throw null==t&&(t=""),new Error("`html` not implemented")},t.prototype.bind=function(t,e){return void 0===this._bindings[t]&&(this._bindings[t]=[]),this._bindings[t].push(e),e},t.prototype.trigger=function(){var t,e,n,i,r,s,a;if(n=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],this._bindings[n]){for(s=this._bindings[n],a=[],i=0,r=s.length;r>i;i++)e=s[i],e&&a.push(e.call.apply(e,[this].concat(o.call(t))));return a}},t.prototype.unbind=function(t,e){var n,o,i,r,s,a;if(!t)return void(this._bindings={});if(!e)return void(this._bindings[t]=void 0);if(this._bindings[t]){for(s=this._bindings[t],a=[],n=i=0,r=s.length;r>i;n=++i)o=s[n],a.push(o===e?this._bindings[t].splice(n,1):void 0);return a}},t.prototype.commit=function(){return this._modified=null,ContentEdit.Root.get().trigger("commit",this)},t.prototype.taint=function(){var t,e,n,o,i,r;for(t=Date.now(),this._modified=t,r=this.parents(),o=0,i=r.length;i>o;o++)e=r[o],e._modified=t;return n=ContentEdit.Root.get(),n._modified=t,n.trigger("taint",this)},t.prototype.closest=function(t){var e;for(e=this.parent();e&&!t(e);)e=e.parent?e.parent():null;return e},t.prototype.next=function(){var t,e,n,o,i,r;if(this.children&&this.children.length>0)return this.children[0];for(r=[this].concat(this.parents()),o=0,i=r.length;i>o;o++){if(n=r[o],!n.parent())return null;if(t=n.parent().children,e=t.indexOf(n),e<t.length-1)return t[e+1]}},t.prototype.nextContent=function(){return this.nextWithTest(function(t){return void 0!==t.content})},t.prototype.nextSibling=function(){var t;return t=this.parent().children.indexOf(this),t===this.parent().children.length-1?null:this.parent().children[t+1]},t.prototype.nextWithTest=function(t){var e;for(e=this;e;)if(e=e.next(),e&&t(e))return e},t.prototype.previous=function(){var t,e;if(!this.parent())return null;if(t=this.parent().children,t[0]===this)return this.parent();for(e=t[t.indexOf(this)-1];e.children&&e.children.length;)e=e.children[e.children.length-1];return e},t.prototype.previousContent=function(){var t;return t=this.previousWithTest(function(t){return void 0!==t.content})},t.prototype.previousSibling=function(){var t;return t=this.parent().children.indexOf(this),0===t?null:this.parent().children[t-1]},t.prototype.previousWithTest=function(t){var e;for(e=this;e;)if(e=e.previous(),e&&t(e))return e},t.extend=function(t){var e,n,o;o=t.prototype;for(e in o)n=o[e],"constructor"!==e&&(this.prototype[e]=n);for(e in t)n=t[e],i.call("__super__",e)>=0||(this.prototype[e]=n);return this},t.fromDOMElement=function(){throw new Error("`fromDOMElement` not implemented")},t}(),ContentEdit.NodeCollection=function(t){function e(){e.__super__.constructor.call(this),this.children=[]}return s(e,t),e.prototype.descendants=function(){var t,e,n;for(t=[],n=this.children.slice();n.length>0;)e=n.shift(),t.push(e),e.children&&e.children.length>0&&(n=e.children.slice().concat(n));return t},e.prototype.isMounted=function(){return!1},e.prototype.type=function(){return"NodeCollection"},e.prototype.attach=function(t,e){return t.parent()&&t.parent().detach(t),t._parent=this,void 0!==e?this.children.splice(e,0,t):this.children.push(t),t.mount&&this.isMounted()&&t.mount(),this.taint(),ContentEdit.Root.get().trigger("attach",this,t)},e.prototype.commit=function(){var t,e,n,o;for(o=this.descendants(),e=0,n=o.length;n>e;e++)t=o[e],t._modified=null;return this._modified=null,ContentEdit.Root.get().trigger("commit",this)},e.prototype.detach=function(t){var e;return e=this.children.indexOf(t),-1!==e?(t.unmount&&this.isMounted()&&t.isMounted()&&t.unmount(),this.children.splice(e,1),t._parent=null,this.taint(),ContentEdit.Root.get().trigger("detach",this,t)):void 0},e}(ContentEdit.Node),ContentEdit.Element=function(t){function e(t,n){e.__super__.constructor.call(this),this._tagName=t.toLowerCase(),this._attributes=n?n:{},this._domElement=null}return s(e,t),e.prototype.attributes=function(){var t,e,n,o;t={},o=this._attributes;for(e in o)n=o[e],t[e]=n;return t},e.prototype.cssTypeName=function(){return"element"},e.prototype.domElement=function(){return this._domElement},e.prototype.isFocused=function(){return ContentEdit.Root.get().focused()===this},e.prototype.isMounted=function(){return null!==this._domElement},e.prototype.type=function(){return"Element"},e.prototype.typeName=function(){return"Element"},e.prototype.addCSSClass=function(t){var e;return e=!1,this.hasCSSClass(t)||(e=!0,this.attr("class")?this.attr("class",""+this.attr("class")+" "+t):this.attr("class",t)),this._addCSSClass(t),e?this.taint():void 0},e.prototype.attr=function(t,e){return t=t.toLowerCase(),void 0===e?this._attributes[t]:(this._attributes[t]=e,this.isMounted()&&"class"!==t.toLowerCase()&&this._domElement.setAttribute(t,e),this.taint())},e.prototype.blur=function(){var t;return t=ContentEdit.Root.get(),this.isFocused()?(this._removeCSSClass("ce-element--focused"),t._focused=null,t.trigger("blur",this)):void 0},e.prototype.createDraggingDOMElement=function(){var t;return this.isMounted()?(t=document.createElement("div"),t.setAttribute("class","ce-drag-helper ce-drag-helper--type-"+this.cssTypeName()),t.setAttribute("data-ce-type",ContentEdit._(this.typeName())),t):void 0},e.prototype.drag=function(t,e){var n;return this.isMounted()?(n=ContentEdit.Root.get(),n.startDragging(this,t,e),n.trigger("drag",this)):void 0},e.prototype.drop=function(t,e){var n;if(n=ContentEdit.Root.get(),t){if(t._removeCSSClass("ce-element--drop"),t._removeCSSClass("ce-element--drop-"+e[0]),t._removeCSSClass("ce-element--drop-"+e[1]),this.constructor.droppers[t.type()])return this.constructor.droppers[t.type()](this,t,e),void n.trigger("drop",this,t,e);if(t.constructor.droppers[this.type()])return t.constructor.droppers[this.type()](this,t,e),void n.trigger("drop",this,t,e)}return n.trigger("drop",this,null,null)},e.prototype.focus=function(t){var e;return e=ContentEdit.Root.get(),this.isFocused()?void 0:(e.focused()&&e.focused().blur(),this._addCSSClass("ce-element--focused"),e._focused=this,this.isMounted()&&!t&&this.domElement().focus(),e.trigger("focus",this))},e.prototype.hasCSSClass=function(t){var e,n;return this.attr("class")&&(n=function(){var t,n,o,i;for(o=this.attr("class").split(" "),i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(e);return i}.call(this),n.indexOf(t)>-1)?!0:!1},e.prototype.merge=function(t){return this.constructor.mergers[t.type()]?this.constructor.mergers[t.type()](t,this):t.constructor.mergers[this.type()]?t.constructor.mergers[this.type()](t,this):void 0},e.prototype.mount=function(){var t;return this._domElement||(this._domElement=document.createElement(this.tagName())),
t=this.nextSibling(),t?this.parent().domElement().insertBefore(this._domElement,t.domElement()):this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),this._addCSSClass("ce-element"),this._addCSSClass("ce-element--type-"+this.cssTypeName()),this.isFocused()&&this._addCSSClass("ce-element--focused"),ContentEdit.Root.get().trigger("mount",this)},e.prototype.removeAttr=function(t){return t=t.toLowerCase(),this._attributes[t]?(delete this._attributes[t],this.isMounted()&&"class"!==t.toLowerCase()&&this._domElement.removeAttribute(t),this.taint()):void 0},e.prototype.removeCSSClass=function(t){var e,n,o;return this.hasCSSClass(t)?(o=function(){var t,n,o,i;for(o=this.attr("class").split(" "),i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(e);return i}.call(this),n=o.indexOf(t),n>-1&&o.splice(n,1),o.length?this.attr("class",o.join(" ")):this.removeAttr("class"),this._removeCSSClass(t),this.taint()):void 0},e.prototype.tagName=function(t){return void 0===t?this._tagName:(this._tagName=t.toLowerCase(),this.isMounted()&&(this.unmount(),this.mount()),this.taint())},e.prototype.unmount=function(){return this._removeDOMEventListeners(),this._domElement.parentNode&&this._domElement.parentNode.removeChild(this._domElement),this._domElement=null,ContentEdit.Root.get().trigger("unmount",this)},e.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("focus",function(){return function(t){return t.preventDefault()}}(this)),this._domElement.addEventListener("dragstart",function(){return function(t){return t.preventDefault()}}(this)),this._domElement.addEventListener("keydown",function(t){return function(e){return t._onKeyDown(e)}}(this)),this._domElement.addEventListener("keyup",function(t){return function(e){return t._onKeyUp(e)}}(this)),this._domElement.addEventListener("mousedown",function(t){return function(e){return 0===e.button?t._onMouseDown(e):void 0}}(this)),this._domElement.addEventListener("mousemove",function(t){return function(e){return t._onMouseMove(e)}}(this)),this._domElement.addEventListener("mouseover",function(t){return function(e){return t._onMouseOver(e)}}(this)),this._domElement.addEventListener("mouseout",function(t){return function(e){return t._onMouseOut(e)}}(this)),this._domElement.addEventListener("mouseup",function(t){return function(e){return 0===e.button?t._onMouseUp(e):void 0}}(this)),this._domElement.addEventListener("paste",function(t){return function(e){return t._onPaste(e)}}(this)),this._domElement.addEventListener("dragover",function(){return function(t){return t.preventDefault()}}(this)),this._domElement.addEventListener("drop",function(t){return function(e){return t._onNativeDrop(e)}}(this))},e.prototype._onKeyDown=function(){},e.prototype._onKeyUp=function(){},e.prototype._onMouseDown=function(){return this.focus?this.focus(!0):void 0},e.prototype._onMouseMove=function(t){return this._onOver(t)},e.prototype._onMouseOver=function(t){return this._onOver(t)},e.prototype._onMouseOut=function(){var t,e;return this._removeCSSClass("ce-element--over"),e=ContentEdit.Root.get(),t=e.dragging(),t?(this._removeCSSClass("ce-element--drop"),this._removeCSSClass("ce-element--drop-above"),this._removeCSSClass("ce-element--drop-below"),this._removeCSSClass("ce-element--drop-center"),this._removeCSSClass("ce-element--drop-left"),this._removeCSSClass("ce-element--drop-right"),e._dropTarget=null):void 0},e.prototype._onMouseUp=function(){},e.prototype._onNativeDrop=function(t){return t.preventDefault(),t.stopPropagation(),ContentEdit.Root.get().trigger("native-drop",this,t)},e.prototype._onPaste=function(t){return t.preventDefault(),t.stopPropagation(),ContentEdit.Root.get().trigger("paste",this,t)},e.prototype._onOver=function(){var t,e;return this._addCSSClass("ce-element--over"),e=ContentEdit.Root.get(),t=e.dragging(),t&&t!==this&&!e._dropTarget&&(this.constructor.droppers[t.type()]||t.constructor.droppers[this.type()])?(this._addCSSClass("ce-element--drop"),e._dropTarget=this):void 0},e.prototype._removeDOMEventListeners=function(){},e.prototype._addCSSClass=function(t){return this.isMounted()?ContentEdit.addCSSClass(this._domElement,t):void 0},e.prototype._attributesToString=function(){return Object.getOwnPropertyNames(this._attributes).length>0?" "+ContentEdit.attributesToString(this._attributes):""},e.prototype._removeCSSClass=function(t){return this.isMounted()?ContentEdit.removeCSSClass(this._domElement,t):void 0},e.droppers={},e.mergers={},e.placements=["above","below"],e.getDOMElementAttributes=function(t){var e,n,o,i,r;if(!t.hasAttributes())return{};for(n={},r=t.attributes,o=0,i=r.length;i>o;o++)e=r[o],n[e.name.toLowerCase()]=e.value;return n},e._dropVert=function(t,e,n){var o;return t.parent().detach(t),o=e.parent().children.indexOf(e),"below"===n[0]&&(o+=1),e.parent().attach(t,o)},e._dropBoth=function(t,e,n){var o,i,r,s,a,l;if(t.parent().detach(t),r=e.parent().children.indexOf(e),"below"===n[0]&&"center"===n[1]&&(r+=1),t.a){if(t._removeCSSClass("align-left"),t._removeCSSClass("align-right"),t.a["class"]){for(o=[],l=t.a["class"].split(" "),s=0,a=l.length;a>s;s++)i=l[s],"align-left"!==i&&"align-right"!==i&&o.push(i);o.length?t.a["class"]=o.join(" "):delete t.a["class"]}}else t.removeCSSClass("align-left"),t.removeCSSClass("align-right");return"left"===n[1]&&(t.a?(t.a["class"]?t.a["class"]+=" align-left":t.a["class"]="align-left",t._addCSSClass("align-left")):t.addCSSClass("align-left")),"right"===n[1]&&(t.a?(t.a["class"]?t.a["class"]+=" align-right":t.a["class"]="align-right",t._addCSSClass("align-right")):t.addCSSClass("align-right")),e.parent().attach(t,r)},e}(ContentEdit.Node),ContentEdit.ElementCollection=function(t){function e(t,n){e.__super__.constructor.call(this,t,n),ContentEdit.NodeCollection.prototype.constructor.call(this)}return s(e,t),e.extend(ContentEdit.NodeCollection),e.prototype.cssTypeName=function(){return"element-collection"},e.prototype.isMounted=function(){return null!==this._domElement},e.prototype.type=function(){return"ElementCollection"},e.prototype.createDraggingDOMElement=function(){var t,n;return this.isMounted()?(t=e.__super__.createDraggingDOMElement.call(this),n=this._domElement.textContent,n.length>ContentEdit.HELPER_CHAR_LIMIT&&(n=n.substr(0,ContentEdit.HELPER_CHAR_LIMIT)),t.innerHTML=n,t):void 0},e.prototype.detach=function(t){return ContentEdit.NodeCollection.prototype.detach.call(this,t),0===this.children.length&&this.parent()?this.parent().detach(this):void 0},e.prototype.html=function(t){var e,n;return null==t&&(t=""),n=function(){var n,o,i,r;for(i=this.children,r=[],n=0,o=i.length;o>n;n++)e=i[n],r.push(e.html(t+ContentEdit.INDENT));return r}.call(this),""+t+"<"+this.tagName()+this._attributesToString()+">\n"+(""+n.join("\n")+"\n")+(""+t+"</"+this.tagName()+">")},e.prototype.mount=function(){var t,n,o,i,r,s,a,l;this._domElement=document.createElement(this._tagName),s=this._attributes;for(n in s)o=s[n],this._domElement.setAttribute(n,o);for(e.__super__.mount.call(this),a=this.children,l=[],i=0,r=a.length;r>i;i++)t=a[i],l.push(t.mount());return l},e.prototype.unmount=function(){var t,n,o,i;for(i=this.children,n=0,o=i.length;o>n;n++)t=i[n],t.unmount();return e.__super__.unmount.call(this)},e.prototype.blur=void 0,e.prototype.focus=void 0,e}(ContentEdit.Element),ContentEdit.ResizableElement=function(t){function e(t,n){e.__super__.constructor.call(this,t,n),this._domSizeInfoElement=null,this._aspectRatio=1}return s(e,t),e.prototype.aspectRatio=function(){return this._aspectRatio},e.prototype.maxSize=function(){var t;return t=parseInt(this.attr("data-ce-max-width")||0),t||(t=ContentEdit.DEFAULT_MAX_ELEMENT_WIDTH),t=Math.max(t,this.size()[0]),[t,t*this.aspectRatio()]},e.prototype.minSize=function(){var t;return t=parseInt(this.attr("data-ce-min-width")||0),t||(t=ContentEdit.DEFAULT_MIN_ELEMENT_WIDTH),t=Math.min(t,this.size()[0]),[t,t*this.aspectRatio()]},e.prototype.type=function(){return"ResizableElement"},e.prototype.mount=function(){return e.__super__.mount.call(this),this._domElement.setAttribute("data-ce-size",this._getSizeInfo())},e.prototype.resize=function(t,e,n){return this.isMounted()?ContentEdit.Root.get().startResizing(this,t,e,n,!0):void 0},e.prototype.size=function(t){var e,n,o,i;return t?(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),o=this.minSize(),t[0]=Math.max(t[0],o[0]),t[1]=Math.max(t[1],o[1]),n=this.maxSize(),t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1]),this.attr("width",parseInt(t[0])),this.attr("height",parseInt(t[1])),this.isMounted()?(this._domElement.style.width=""+t[0]+"px",this._domElement.style.height=""+t[1]+"px",this._domElement.setAttribute("data-ce-size",this._getSizeInfo())):void 0):(i=parseInt(this.attr("width")||1),e=parseInt(this.attr("height")||1),[i,e])},e.prototype._onMouseDown=function(t){var n;return e.__super__._onMouseDown.call(this,t),n=this._getResizeCorner(t.clientX,t.clientY),n?this.resize(n,t.clientX,t.clientY):(clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),150))},e.prototype._onMouseMove=function(t){var n;return e.__super__._onMouseMove.call(this),this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right"),n=this._getResizeCorner(t.clientX,t.clientY),n?this._addCSSClass("ce-element--resize-"+n[0]+"-"+n[1]):void 0},e.prototype._onMouseOut=function(){return e.__super__._onMouseOut.call(this),this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right")},e.prototype._onMouseUp=function(){return e.__super__._onMouseUp.call(this),this._dragTimeout?clearTimeout(this._dragTimeout):void 0},e.prototype._getResizeCorner=function(t,e){var n,o,i,r,s;return i=this._domElement.getBoundingClientRect(),s=[t-i.left,e-i.top],t=s[0],e=s[1],r=this.size(),o=ContentEdit.RESIZE_CORNER_SIZE,o=Math.min(o,Math.max(parseInt(r[0]/4),1)),o=Math.min(o,Math.max(parseInt(r[1]/4),1)),n=null,o>t?o>e?n=["top","left"]:e>i.height-o&&(n=["bottom","left"]):t>i.width-o&&(o>e?n=["top","right"]:e>i.height-o&&(n=["bottom","right"])),n},e.prototype._getSizeInfo=function(){var t;return t=this.size(),"w "+t[0]+" × h "+t[1]},e}(ContentEdit.Element),ContentEdit.Region=function(t){function e(t){var n,o,i,r,s,a,l,u;for(e.__super__.constructor.call(this),this._domElement=t,a=ContentEdit.TagNames.get(),i=function(){var t,e,o,i;for(o=this._domElement.childNodes,i=[],t=0,e=o.length;e>t;t++)n=o[t],i.push(n);return i}.call(this),l=0,u=i.length;u>l;l++)o=i[l],1===o.nodeType&&(r=a.match(o.getAttribute("data-ce-tag")?o.getAttribute("data-ce-tag"):o.tagName),s=r.fromDOMElement(o),this._domElement.removeChild(o),s&&this.attach(s))}return s(e,t),e.prototype.domElement=function(){return this._domElement},e.prototype.isMounted=function(){return!0},e.prototype.type=function(){return"Region"},e.prototype.html=function(t){var e;return null==t&&(t=""),function(){var n,o,i,r;for(i=this.children,r=[],n=0,o=i.length;o>n;n++)e=i[n],r.push(e.html(t));return r}.call(this).join("\n").trim()},e}(ContentEdit.NodeCollection),t=function(t){function e(){this._onStopResizing=a(this._onStopResizing,this),this._onResize=a(this._onResize,this),this._onStopDragging=a(this._onStopDragging,this),this._onDrag=a(this._onDrag,this),e.__super__.constructor.call(this),this._focused=null,this._dragging=null,this._dropTarget=null,this._draggingDOMElement=null,this._resizing=null,this._resizingInit=null}return s(e,t),e.prototype.dragging=function(){return this._dragging},e.prototype.dropTarget=function(){return this._dropTarget},e.prototype.focused=function(){return this._focused},e.prototype.resizing=function(){return this._resizing},e.prototype.type=function(){return"Root"},e.prototype.cancelDragging=function(){return this._dragging?(document.body.removeChild(this._draggingDOMElement),document.removeEventListener("mousemove",this._onDrag),document.removeEventListener("mouseup",this._onStopDragging),this._dragging._removeCSSClass("ce-element--dragging"),this._dragging=null,this._dropTarget=null,ContentEdit.removeCSSClass(document.body,"ce--dragging")):void 0},e.prototype.startDragging=function(t,e,n){return this._dragging?void 0:(this._dragging=t,this._dragging._addCSSClass("ce-element--dragging"),this._draggingDOMElement=this._dragging.createDraggingDOMElement(),document.body.appendChild(this._draggingDOMElement),this._draggingDOMElement.style.left=""+e+"px",this._draggingDOMElement.style.top=""+n+"px",document.addEventListener("mousemove",this._onDrag),document.addEventListener("mouseup",this._onStopDragging),ContentEdit.addCSSClass(document.body,"ce--dragging"))},e.prototype._getDropPlacement=function(t,e){var n,o,i,r;return this._dropTarget?(o=this._dropTarget.domElement().getBoundingClientRect(),r=[t-o.left,e-o.top],t=r[0],e=r[1],n="center",t<ContentEdit.DROP_EDGE_SIZE?n="left":t>o.width-ContentEdit.DROP_EDGE_SIZE&&(n="right"),i="above",e>o.height/2&&(i="below"),[i,n]):null},e.prototype._onDrag=function(t){var e,n,o;return ContentSelect.Range.unselectAll(),this._draggingDOMElement.style.left=""+t.pageX+"px",this._draggingDOMElement.style.top=""+t.pageY+"px",this._dropTarget&&(e=this._getDropPlacement(t.clientX,t.clientY),this._dropTarget._removeCSSClass("ce-element--drop-above"),this._dropTarget._removeCSSClass("ce-element--drop-below"),this._dropTarget._removeCSSClass("ce-element--drop-center"),this._dropTarget._removeCSSClass("ce-element--drop-left"),this._dropTarget._removeCSSClass("ce-element--drop-right"),n=e[0],i.call(this._dragging.constructor.placements,n)>=0&&this._dropTarget._addCSSClass("ce-element--drop-"+e[0]),o=e[1],i.call(this._dragging.constructor.placements,o)>=0)?this._dropTarget._addCSSClass("ce-element--drop-"+e[1]):void 0},e.prototype._onStopDragging=function(t){var e;return e=this._getDropPlacement(t.clientX,t.clientY),this._dragging.drop(this._dropTarget,e),this.cancelDragging()},e.prototype.startResizing=function(t,e,n,o,i){var r,s;return this._resizing?void 0:(this._resizing=t,this._resizingInit={corner:e,fixed:i,origin:[n,o],size:t.size()},this._resizing._addCSSClass("ce-element--resizing"),s=this._resizing.parent().domElement(),r=document.createElement("div"),r.setAttribute("class","ce-measure"),s.appendChild(r),this._resizingParentWidth=r.getBoundingClientRect().width,s.removeChild(r),document.addEventListener("mousemove",this._onResize),document.addEventListener("mouseup",this._onStopResizing),ContentEdit.addCSSClass(document.body,"ce--resizing"))},e.prototype._onResize=function(t){var e,n,o,i;return ContentSelect.Range.unselectAll(),o=this._resizingInit.origin[0]-t.clientX,"right"===this._resizingInit.corner[1]&&(o=-o),n=this._resizingInit.size[0]+o,n=Math.min(n,this._resizingParentWidth),this._resizingInit.fixed?e=n*this._resizing.aspectRatio():(i=this._resizingInit.origin[1]-t.clientY,"bottom"===this._resizingInit.corner[0]&&(i=-i),e=this._resizingInit.size[1]+i),this._resizing.size([n,e])},e.prototype._onStopResizing=function(){return document.removeEventListener("mousemove",this._onResize),document.removeEventListener("mouseup",this._onStopResizing),this._resizing._removeCSSClass("ce-element--resizing"),this._resizing=null,this._resizingInit=null,this._resizingParentWidth=null,ContentEdit.removeCSSClass(document.body,"ce--resizing")},e}(ContentEdit.Node),ContentEdit.Root=function(){function e(){}var n;return n=null,e.get=function(){return null!=n?n:n=new t},e}(),ContentEdit.Static=function(t){function e(t,n,o){e.__super__.constructor.call(this,t,n),this._content=o}return s(e,t),e.prototype.cssTypeName=function(){return"static"},e.prototype.type=function(){return"Static"},e.prototype.typeName=function(){return"Static"},e.prototype.createDraggingDOMElement=function(){var t,n;return this.isMounted()?(t=e.__super__.createDraggingDOMElement.call(this),n=this._domElement.textContent,n.length>ContentEdit.HELPER_CHAR_LIMIT&&(n=n.substr(0,ContentEdit.HELPER_CHAR_LIMIT)),t.innerHTML=n,t):void 0},e.prototype.html=function(t){return null==t&&(t=""),HTMLString.Tag.SELF_CLOSING[this._tagName]?""+t+"<"+this._tagName+this._attributesToString()+">":""+t+"<"+this._tagName+this._attributesToString()+">"+this._content+(""+t+"</"+this._tagName+">")},e.prototype.mount=function(){var t,n,o;this._domElement=document.createElement(this._tagName),o=this._attributes;for(t in o)n=o[t],this._domElement.setAttribute(t,n);return this._domElement.innerHTML=this._content,e.__super__.mount.call(this)},e.prototype.blur=void 0,e.prototype.focus=void 0,e.prototype._onMouseDown=function(t){return e.__super__._onMouseDown.call(this,t),void 0!==this.attr("data-ce-moveable")?(clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),150)):void 0},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.prototype._onMouseUp=function(t){return e.__super__._onMouseUp.call(this,t),this._dragTimeout?clearTimeout(this._dragTimeout):void 0},e.droppers={Static:ContentEdit.Element._dropVert},e.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML)},e}(ContentEdit.Element),ContentEdit.TagNames.get().register(ContentEdit.Static,"static"),ContentEdit.Text=function(t){function e(t,n,o){e.__super__.constructor.call(this,t,n),this.content=o instanceof HTMLString.String?o:new HTMLString.String(o).trim()}return s(e,t),e.prototype.cssTypeName=function(){return"text"},e.prototype.type=function(){return"Text"},e.prototype.typeName=function(){return"Text"},e.prototype.blur=function(){var t;if(this.isMounted()&&this._syncContent(),this.content.isWhitespace())this.parent()&&this.parent().detach(this);else if(this.isMounted()){try{this._domElement.blur()}catch(n){t=n}this._domElement.removeAttribute("contenteditable")}return e.__super__.blur.call(this)},e.prototype.createDraggingDOMElement=function(){var t,n;return this.isMounted()?(t=e.__super__.createDraggingDOMElement.call(this),n=HTMLString.String.encode(this._domElement.textContent),n.length>ContentEdit.HELPER_CHAR_LIMIT&&(n=n.substr(0,ContentEdit.HELPER_CHAR_LIMIT)),t.innerHTML=n,t):void 0},e.prototype.drag=function(t,n){return this.storeState(),this._domElement.removeAttribute("contenteditable"),e.__super__.drag.call(this,t,n)},e.prototype.drop=function(t,n){return e.__super__.drop.call(this,t,n),this.restoreState()},e.prototype.focus=function(t){return this.isMounted()&&this._domElement.setAttribute("contenteditable",""),e.__super__.focus.call(this,t)},e.prototype.html=function(t){var e;return null==t&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(e=this.content.copy().trim(),e.optimize(),this._lastCached=Date.now(),this._cached=e.html()),""+t+"<"+this._tagName+this._attributesToString()+">\n"+(""+t+ContentEdit.INDENT+this._cached+"\n")+(""+t+"</"+this._tagName+">")},e.prototype.mount=function(){var t,n,o;this._domElement=document.createElement(this._tagName),o=this._attributes;for(t in o)n=o[t],this._domElement.setAttribute(t,n);return this.updateInnerHTML(),e.__super__.mount.call(this)},e.prototype.restoreState=function(){return this._savedSelection?this.isMounted()&&this.isFocused()?(this._domElement.setAttribute("contenteditable",""),this._addCSSClass("ce-element--focused"),document.activeElement!==this.domElement()&&this.domElement().focus(),this._savedSelection.select(this._domElement),this._savedSelection=void 0):void(this._savedSelection=void 0):void 0},e.prototype.selection=function(t){return void 0===t?this.isMounted()?ContentSelect.Range.query(this._domElement):new ContentSelect.Range(0,0):t.select(this._domElement)},e.prototype.storeState=function(){return this.isMounted()&&this.isFocused()?this._savedSelection=ContentSelect.Range.query(this._domElement):void 0},e.prototype.updateInnerHTML=function(){return this._domElement.innerHTML=this.content.html(),ContentSelect.Range.prepareElement(this._domElement),this._flagIfEmpty()},e.prototype._onKeyDown=function(t){switch(t.keyCode){case 40:return this._keyDown(t);case 37:return this._keyLeft(t);case 39:return this._keyRight(t);case 38:return this._keyUp(t);case 9:return this._keyTab(t);case 8:return this._keyBack(t);case 46:return this._keyDelete(t);case 13:return this._keyReturn(t)}},e.prototype._onKeyUp=function(t){return e.__super__._onKeyUp.call(this,t),this._syncContent()},e.prototype._onMouseDown=function(t){return e.__super__._onMouseDown.call(this,t),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION),0===this.content.length()&&ContentEdit.Root.get().focused()===this?(t.preventDefault(),document.activeElement!==this._domElement&&this._domElement.focus(),new ContentSelect.Range(0,0).select(this._domElement)):void 0},e.prototype._onMouseMove=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),e.__super__._onMouseMove.call(this,t)},e.prototype._onMouseOut=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),e.__super__._onMouseOut.call(this,t)},e.prototype._onMouseUp=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),e.__super__._onMouseUp.call(this,t)},e.prototype._keyBack=function(t){var e,n;return n=ContentSelect.Range.query(this._domElement),0===n.get()[0]&&n.isCollapsed()?(t.preventDefault(),e=this.previousContent(),this._syncContent(),e?e.merge(this):void 0):void 0},e.prototype._keyDelete=function(t){var e,n;return n=ContentSelect.Range.query(this._domElement),this._atEnd(n)&&n.isCollapsed()?(t.preventDefault(),e=this.nextContent(),e?this.merge(e):void 0):void 0},e.prototype._keyDown=function(t){return this._keyRight(t)},e.prototype._keyLeft=function(t){var e,n;return n=ContentSelect.Range.query(this._domElement),0===n.get()[0]&&n.isCollapsed()?(t.preventDefault(),e=this.previousContent(),e?(e.focus(),n=new ContentSelect.Range(e.content.length(),e.content.length()),n.select(e.domElement())):ContentEdit.Root.get().trigger("previous-region",this.closest(function(t){return"Region"===t.type()}))):void 0},e.prototype._keyReturn=function(t){var e,n,o,i,r,s;return t.preventDefault(),this.content.isWhitespace()?void 0:(ContentSelect.Range.query(this._domElement),i=ContentSelect.Range.query(this._domElement),s=this.content.substring(0,i.get()[0]),r=this.content.substring(i.get()[1]),t.shiftKey?(n=i.get()[0],o="<br>",this.content.length()===n&&(this.content.characters[n-1].isTag("br")||(o="<br><br>")),this.content=this.content.insert(n,new HTMLString.String(o,!0),!0),this.updateInnerHTML(),n+=1,i=new ContentSelect.Range(n,n),void i.select(this.domElement())):(this.content=s.trim(),this.updateInnerHTML(),e=new this.constructor("p",{},r.trim()),this.parent().attach(e,this.parent().children.indexOf(this)+1),s.length()?(e.focus(),i=new ContentSelect.Range(0,0),i.select(e.domElement())):(i=new ContentSelect.Range(0,s.length()),i.select(this._domElement)),this.taint()))},e.prototype._keyRight=function(t){var e,n;return n=ContentSelect.Range.query(this._domElement),this._atEnd(n)&&n.isCollapsed()?(t.preventDefault(),e=this.nextContent(),e?(e.focus(),n=new ContentSelect.Range(0,0),n.select(e.domElement())):ContentEdit.Root.get().trigger("next-region",this.closest(function(t){return"Region"===t.type()}))):void 0},e.prototype._keyTab=function(t){return t.preventDefault()},e.prototype._keyUp=function(t){return this._keyLeft(t)},e.prototype._atEnd=function(t){var e;return e=t.get()[0]===this.content.length(),t.get()[0]===this.content.length()-1&&this.content.characters[this.content.characters.length-1].isTag("br")&&(e=!0),e},e.prototype._flagIfEmpty=function(){return 0===this.content.length()?this._addCSSClass("ce-element--empty"):this._removeCSSClass("ce-element--empty")},e.prototype._syncContent=function(){var t,e;return e=this.content.html(),this.content=new HTMLString.String(this._domElement.innerHTML,this.content.preserveWhitespace()),t=this.content.html(),e!==t&&this.taint(),this._flagIfEmpty()},e.droppers={Static:ContentEdit.Element._dropVert,Text:ContentEdit.Element._dropVert},e.mergers={Text:function(t,e){var n;return n=e.content.length(),t.content.length()&&(e.content=e.content.concat(t.content)),e.isMounted()&&e.updateInnerHTML(),e.focus(),new ContentSelect.Range(n,n).select(e._domElement),t.parent()&&t.parent().detach(t),e.taint()}},e.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML.replace(/^\s+|\s+$/g,""))},e}(ContentEdit.Element),ContentEdit.TagNames.get().register(ContentEdit.Text,"address","blockquote","h1","h2","h3","h4","h5","h6","p"),ContentEdit.PreText=function(t){function e(t,e,n){this.content=n instanceof HTMLString.String?n:new HTMLString.String(n,!0),ContentEdit.Element.call(this,t,e)}return s(e,t),e.prototype.cssTypeName=function(){return"pre-text"},e.prototype.type=function(){return"PreText"},e.prototype.typeName=function(){return"Preformatted"},e.prototype.html=function(t){var e;return null==t&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(e=this.content.copy(),e.optimize(),this._lastCached=Date.now(),this._cached=e.html()),""+t+"<"+this._tagName+this._attributesToString()+">"+(""+this._cached+"</"+this._tagName+">")},e.prototype.updateInnerHTML=function(){var t;return t=this.content.html(),t+="\n",this._domElement.innerHTML=t,ContentSelect.Range.prepareElement(this._domElement),this._flagIfEmpty()},e.prototype._onKeyUp=function(){var t,e,n;return n=this.content.html(),t=this._domElement.innerHTML.replace(/[\n]$/,""),this.content=new HTMLString.String(t,this.content.preserveWhitespace()),e=this.content.html(),n!==e&&this.taint(),this._flagIfEmpty()},e.prototype._keyReturn=function(t){var e,n,o,i;return t.preventDefault(),n=ContentSelect.Range.query(this._domElement),e=n.get()[0]+1,0===n.get()[0]&&n.isCollapsed()?this.content=new HTMLString.String("\n",!0).concat(this.content):this._atEnd(n)&&n.isCollapsed()?this.content=this.content.concat(new HTMLString.String("\n",!0)):0===n.get()[0]&&n.get()[1]===this.content.length()?(this.content=new HTMLString.String("\n",!0),e=0):(i=this.content.substring(0,n.get()[0]),o=this.content.substring(n.get()[1]),this.content=i.concat(new HTMLString.String("\n",!0),o)),this.updateInnerHTML(),n.set(e,e),n.select(this._domElement),this.taint()},e.droppers={PreText:ContentEdit.Element._dropVert,Static:ContentEdit.Element._dropVert,Text:ContentEdit.Element._dropVert},e.mergers={},e.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML)},e}(ContentEdit.Text),ContentEdit.TagNames.get().register(ContentEdit.PreText,"pre"),ContentEdit.Image=function(t){function e(t,n){var o;e.__super__.constructor.call(this,"img",t),this.a=n?n:null,o=this.size(),this._aspectRatio=o[1]/o[0]}return s(e,t),e.prototype.cssTypeName=function(){return"image"},e.prototype.type=function(){return"Image"},e.prototype.typeName=function(){return"Image"},e.prototype.createDraggingDOMElement=function(){var t;return this.isMounted()?(t=e.__super__.createDraggingDOMElement.call(this),t.style.backgroundImage="url("+this._attributes.src+")",t):void 0},e.prototype.html=function(t){var e,n;return null==t&&(t=""),n=""+t+"<img"+this._attributesToString()+">",this.a?(e=ContentEdit.attributesToString(this.a),e=""+e+' data-ce-tag="img"',""+t+"<a "+e+">\n"+(""+ContentEdit.INDENT+n+"\n")+(""+t+"</a>")):n},e.prototype.mount=function(){var t,n;return this._domElement=document.createElement("div"),t="",this.a&&this.a["class"]&&(t+=" "+this.a["class"]),this._attributes["class"]&&(t+=" "+this._attributes["class"]),this._domElement.setAttribute("class",t),n=this._attributes.style?this._attributes.style:"",n+="background-image:url("+this._attributes.src+");",this._attributes.width&&(n+="width:"+this._attributes.width+"px;"),this._attributes.height&&(n+="height:"+this._attributes.height+"px;"),this._domElement.setAttribute("style",n),e.__super__.mount.call(this)},e.droppers={Image:ContentEdit.Element._dropBoth,PreText:ContentEdit.Element._dropBoth,Static:ContentEdit.Element._dropBoth,Text:ContentEdit.Element._dropBoth},e.placements=["above","below","left","right","center"],e.fromDOMElement=function(t){var e,n,o,i,r,s,a;if(e=null,"a"===t.tagName.toLowerCase()){for(e=this.getDOMElementAttributes(t),r=function(){var e,n,i,r;for(i=t.childNodes,r=[],e=0,n=i.length;n>e;e++)o=i[e],r.push(o);return r}(),s=0,a=r.length;a>s;s++)if(i=r[s],1===i.nodeType&&"img"===i.tagName.toLowerCase()){t=i;break}"a"===t.tagName.toLowerCase()&&(t=document.createElement("img"))}return n=this.getDOMElementAttributes(t),void 0===n.width&&(n.width=void 0===n.height?t.naturalWidth:t.clientWidth),void 0===n.height&&(n.height=void 0===n.width?t.naturalHeight:t.clientHeight),new this(n,e)},e}(ContentEdit.ResizableElement),ContentEdit.TagNames.get().register(ContentEdit.Image,"img"),ContentEdit.Video=function(t){function e(t,n,o){var i;null==o&&(o=[]),e.__super__.constructor.call(this,t,n),this.sources=o,i=this.size(),this._aspectRatio=i[1]/i[0]}return s(e,t),e.prototype.cssTypeName=function(){return"video"},e.prototype.type=function(){return"Video"},e.prototype.typeName=function(){return"Video"},e.prototype._title=function(){var t;return t="",this.attr("src")?t=this.attr("src"):this.sources.length&&(t=this.sources[0].src),t||(t="No video source set"),t.length>ContentEdit.HELPER_CHAR_LIMIT&&(t=text.substr(0,ContentEdit.HELPER_CHAR_LIMIT)),t},e.prototype.createDraggingDOMElement=function(){var t;return this.isMounted()?(t=e.__super__.createDraggingDOMElement.call(this),t.innerHTML=this._title(),t):void 0},e.prototype.html=function(t){var e,n,o,i,r,s;if(null==t&&(t=""),"video"===this.tagName()){for(o=[],s=this.sources,i=0,r=s.length;r>i;i++)n=s[i],e=ContentEdit.attributesToString(n),o.push(""+t+ContentEdit.INDENT+"<source "+e+">");return""+t+"<video"+this._attributesToString()+">\n"+o.join("\n")+("\n"+t+"</video>")}return""+t+"<"+this._tagName+this._attributesToString()+">"+("</"+this._tagName+">")},e.prototype.mount=function(){var t;return this._domElement=document.createElement("div"),this.a&&this.a["class"]?this._domElement.setAttribute("class",this.a["class"]):this._attributes["class"]&&this._domElement.setAttribute("class",this._attributes["class"]),t=this._attributes.style?this._attributes.style:"",this._attributes.width&&(t+="width:"+this._attributes.width+"px;"),this._attributes.height&&(t+="height:"+this._attributes.height+"px;"),this._domElement.setAttribute("style",t),this._domElement.setAttribute("data-ce-title",this._title()),e.__super__.mount.call(this)},e.droppers={Image:ContentEdit.Element._dropBoth,PreText:ContentEdit.Element._dropBoth,Static:ContentEdit.Element._dropBoth,Text:ContentEdit.Element._dropBoth,Video:ContentEdit.Element._dropBoth},e.placements=["above","below","left","right","center"],e.fromDOMElement=function(t){var e,n,o,i,r,s;for(o=function(){var n,o,i,r;for(i=t.childNodes,r=[],n=0,o=i.length;o>n;n++)e=i[n],r.push(e);return r}(),i=[],r=0,s=o.length;s>r;r++)n=o[r],1===n.nodeType&&"source"===n.tagName.toLowerCase()&&i.push(this.getDOMElementAttributes(n));return new this(t.tagName,this.getDOMElementAttributes(t),i)},e}(ContentEdit.ResizableElement),ContentEdit.TagNames.get().register(ContentEdit.Video,"iframe","video"),ContentEdit.List=function(t){function e(t,n){e.__super__.constructor.call(this,t,n)}return s(e,t),e.prototype.cssTypeName=function(){return"list"},e.prototype.type=function(){return"List"},e.prototype.typeName=function(){return"List"},e.prototype._onMouseOver=function(t){return"ListItem"!==this.parent().type()?(e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")):void 0},e.droppers={Image:ContentEdit.Element._dropBoth,List:ContentEdit.Element._dropVert,PreText:ContentEdit.Element._dropVert,
Static:ContentEdit.Element._dropVert,Text:ContentEdit.Element._dropVert,Video:ContentEdit.Element._dropBoth},e.fromDOMElement=function(t){var e,n,o,i,r,s;for(i=new this(t.tagName,this.getDOMElementAttributes(t)),o=function(){var n,o,i,r;for(i=t.childNodes,r=[],n=0,o=i.length;o>n;n++)e=i[n],r.push(e);return r}(),r=0,s=o.length;s>r;r++)n=o[r],1===n.nodeType&&"li"===n.tagName.toLowerCase()&&i.attach(ContentEdit.ListItem.fromDOMElement(n));return 0===i.children.length?null:i},e}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.List,"ol","ul"),ContentEdit.ListItem=function(t){function e(t){e.__super__.constructor.call(this,"li",t)}return s(e,t),e.prototype.cssTypeName=function(){return"list-item"},e.prototype.list=function(){return 2===this.children.length?this.children[1]:null},e.prototype.listItemText=function(){return this.children.length>0?this.children[0]:null},e.prototype.type=function(){return"ListItem"},e.prototype.html=function(t){var e;return null==t&&(t=""),e=[""+t+"<li"+this._attributesToString()+">"],this.listItemText()&&e.push(this.listItemText().html(t+ContentEdit.INDENT)),this.list()&&e.push(this.list().html(t+ContentEdit.INDENT)),e.push(""+t+"</li>"),e.join("\n")},e.prototype.indent=function(){var t;return 0!==this.parent().children.indexOf(this)?(t=this.previousSibling(),t.list()||t.attach(new ContentEdit.List(t.parent().tagName())),this.listItemText().storeState(),this.parent().detach(this),t.list().attach(this),this.listItemText().restoreState()):void 0},e.prototype.remove=function(){var t,e,n,o,i,r;if(this.parent()){if(n=this.parent().children.indexOf(this),this.list())for(r=this.list().children.slice(),e=o=0,i=r.length;i>o;e=++o)t=r[e],t.parent().detach(t),this.parent().attach(t,e+n);return this.parent().detach(this)}},e.prototype.unindent=function(){var t,e,n,o,i,r,s,a,l,u,h,c,d,p,_,m,g,f,C,v,y;if(r=this.parent(),e=r.parent(),u=r.children.slice(r.children.indexOf(this)+1,r.children.length),"ListItem"===e.type()){for(this.listItemText().storeState(),r.detach(this),e.parent().attach(this,e.parent().children.indexOf(e)+1),u.length&&!this.list()&&this.attach(new ContentEdit.List(r.tagName())),c=0,m=u.length;m>c;c++)l=u[c],l.parent().detach(l),this.list().attach(l);return this.listItemText().restoreState()}if(h=new ContentEdit.Text("p",this.attr("class")?{"class":this.attr("class")}:{},this.listItemText().content),a=null,this.listItemText().isFocused()&&(a=ContentSelect.Range.query(this.listItemText().domElement())),s=e.children.indexOf(r),o=r.children.indexOf(this),0===o){if(i=null,1===r.children.length?(this.list()&&(i=new ContentEdit.List(r.tagName())),e.detach(r)):r.detach(this),e.attach(h,s),i&&e.attach(i,s+1),this.list())for(v=this.list().children.slice(),n=d=0,g=v.length;g>d;n=++d)t=v[n],t.parent().detach(t),i?i.attach(t):r.attach(t,n)}else if(o===r.children.length-1)r.detach(this),e.attach(h,s+1),this.list()&&e.attach(this.list(),s+2);else{if(r.detach(this),e.attach(h,s+1),i=new ContentEdit.List(r.tagName()),e.attach(i,s+2),this.list())for(y=this.list().children.slice(),p=0,f=y.length;f>p;p++)t=y[p],t.parent().detach(t),i.attach(t);for(_=0,C=u.length;C>_;_++)l=u[_],l.parent().detach(l),i.attach(l)}return a?(h.focus(),a.select(h.domElement())):void 0},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.prototype._addDOMEventListeners=function(){},e.prototype._removeDOMEventListners=function(){},e.fromDOMElement=function(t){var e,n,o,i,r,s,a,l,u,h;for(r=new this(this.getDOMElementAttributes(t)),n="",o=null,u=t.childNodes,a=0,l=u.length;l>a;a++)e=u[a],1===e.nodeType?"ul"===(h=e.tagName.toLowerCase())||"li"===h?o||(o=e):n+=e.outerHTML:n+=HTMLString.String.encode(e.textContent);return n=n.replace(/^\s+|\s+$/g,""),s=new ContentEdit.ListItemText(n),r.attach(s),o&&(i=ContentEdit.List.fromDOMElement(o),r.attach(i)),r},e}(ContentEdit.ElementCollection),ContentEdit.ListItemText=function(t){function e(t){e.__super__.constructor.call(this,"div",{},t)}return s(e,t),e.prototype.cssTypeName=function(){return"list-item-text"},e.prototype.type=function(){return"ListItemText"},e.prototype.typeName=function(){return"List item"},e.prototype.blur=function(){return this.content.isWhitespace()?this.parent().remove():this.isMounted()&&(this._domElement.blur(),this._domElement.removeAttribute("contenteditable")),ContentEdit.Element.prototype.blur.call(this)},e.prototype.html=function(t){var e;return null==t&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(e=this.content.copy().trim(),e.optimize(),this._lastCached=Date.now(),this._cached=e.html()),""+t+this._cached},e.prototype._onMouseDown=function(t){var e;return ContentEdit.Element.prototype._onMouseDown.call(this,t),e=function(n){return function(){var o;return ContentEdit.Root.get().dragging()===n?(ContentEdit.Root.get().cancelDragging(),o=n.closest(function(t){return"Region"===t.parent().type()}),o.drag(t.pageX,t.pageY)):(n.drag(t.pageX,t.pageY),n._dragTimeout=setTimeout(e,2*ContentEdit.DRAG_HOLD_DURATION))}}(this),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(e,ContentEdit.DRAG_HOLD_DURATION)},e.prototype._onMouseMove=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),ContentEdit.Element.prototype._onMouseMove.call(this,t)},e.prototype._onMouseUp=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),ContentEdit.Element.prototype._onMouseUp.call(this,t)},e.prototype._keyTab=function(t){return t.preventDefault(),t.shiftKey?this.parent().unindent():this.parent().indent()},e.prototype._keyReturn=function(t){var e,n,o,i,r,s;return t.preventDefault(),this.content.isWhitespace()?void this.parent().unindent():(ContentSelect.Range.query(this._domElement),i=ContentSelect.Range.query(this._domElement),s=this.content.substring(0,i.get()[0]),r=this.content.substring(i.get()[1]),s.length()+r.length()===0?void this.parent().unindent():(this.content=s.trim(),this.updateInnerHTML(),e=this.parent().parent(),o=new ContentEdit.ListItem(this.attr("class")?{"class":this.attr("class")}:{}),e.attach(o,e.children.indexOf(this.parent())+1),o.attach(new ContentEdit.ListItemText(r.trim())),n=this.parent().list(),n&&(this.parent().detach(n),o.attach(n)),s.length()?(o.listItemText().focus(),i=new ContentSelect.Range(0,0),i.select(o.listItemText().domElement())):(i=new ContentSelect.Range(0,s.length()),i.select(this._domElement))))},e.droppers={ListItemText:function(t,e,n){var o,i,r,s;return o=t.parent(),s=e.parent(),o.remove(),o.detach(t),r=new ContentEdit.ListItem(o._attributes),r.attach(t),s.list()&&"below"===n[0]?void s.list().attach(r,0):(i=s.parent().children.indexOf(s),"below"===n[0]&&(i+=1),s.parent().attach(r,i))},Text:function(t,e,n){var o,i,r,s,a;if("Text"===t.type()){if(s=e.parent(),t.parent().detach(t),o=t.attr("class"),r=new ContentEdit.ListItem(o?{"class":o}:{}),r.attach(new ContentEdit.ListItemText(t.content)),s.list()&&"below"===n[0])return void s.list().attach(r,0);if(i=s.parent().children.indexOf(s),"below"===n[0]&&(i+=1),s.parent().attach(r,i),r.listItemText().focus(),t._savedSelection)return t._savedSelection.select(r.listItemText().domElement())}else if(o=t.attr("class"),a=new ContentEdit.Text("p",o?{"class":o}:{},t.content),t.parent().remove(),i=e.parent().children.indexOf(e),"below"===n[0]&&(i+=1),e.parent().attach(a,i),a.focus(),t._savedSelection)return t._savedSelection.select(a.domElement())}},e.mergers={ListItemText:function(t,e){var n;return n=e.content.length(),t.content.length()&&(e.content=e.content.concat(t.content)),e.isMounted()&&(e._domElement.innerHTML=e.content.html()),e.focus(),new ContentSelect.Range(n,n).select(e._domElement),"Text"===t.type()?t.parent()&&t.parent().detach(t):t.parent().remove(),e.taint()}},e}(ContentEdit.Text),n=ContentEdit.ListItemText.mergers,n.Text=n.ListItemText,ContentEdit.Table=function(t){function e(t){e.__super__.constructor.call(this,"table",t)}return s(e,t),e.prototype.cssTypeName=function(){return"table"},e.prototype.typeName=function(){return"Table"},e.prototype.type=function(){return"Table"},e.prototype.firstSection=function(){var t;return(t=this.thead())?t:(t=this.tbody())?t:(t=this.tfoot())?t:null},e.prototype.lastSection=function(){var t;return(t=this.tfoot())?t:(t=this.tbody())?t:(t=this.thead())?t:null},e.prototype.tbody=function(){return this._getChild("tbody")},e.prototype.tfoot=function(){return this._getChild("tfoot")},e.prototype.thead=function(){return this._getChild("thead")},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.prototype._getChild=function(t){var e,n,o,i;for(i=this.children,n=0,o=i.length;o>n;n++)if(e=i[n],e.tagName()===t)return e;return null},e.droppers={Image:ContentEdit.Element._dropBoth,List:ContentEdit.Element._dropVert,PreText:ContentEdit.Element._dropVert,Static:ContentEdit.Element._dropVert,Table:ContentEdit.Element._dropVert,Text:ContentEdit.Element._dropVert,Video:ContentEdit.Element._dropBoth},e.fromDOMElement=function(t){var e,n,o,i,r,s,a,l,u,h,c,d;for(a=new this(this.getDOMElementAttributes(t)),o=function(){var n,o,i,r;for(i=t.childNodes,r=[],n=0,o=i.length;o>n;n++)e=i[n],r.push(e);return r}(),i=[],u=0,c=o.length;c>u;u++)if(n=o[u],1===n.nodeType&&(l=n.tagName.toLowerCase(),!a._getChild(l)))switch(l){case"tbody":case"tfoot":case"thead":s=ContentEdit.TableSection.fromDOMElement(n),a.attach(s);break;case"tr":i.push(ContentEdit.TableRow.fromDOMElement(n))}if(i.length>0)for(a._getChild("tbody")||a.attach(new ContentEdit.TableSection("tbody")),h=0,d=i.length;d>h;h++)r=i[h],a.tbody().attach(r);return 0===a.children.length?null:a},e}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.Table,"table"),ContentEdit.TableSection=function(t){function e(t,n){e.__super__.constructor.call(this,t,n)}return s(e,t),e.prototype.cssTypeName=function(){return"table-section"},e.prototype.type=function(){return"TableSection"},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.fromDOMElement=function(t){var e,n,o,i,r,s;for(i=new this(t.tagName,this.getDOMElementAttributes(t)),o=function(){var n,o,i,r;for(i=t.childNodes,r=[],n=0,o=i.length;o>n;n++)e=i[n],r.push(e);return r}(),r=0,s=o.length;s>r;r++)n=o[r],1===n.nodeType&&"tr"===n.tagName.toLowerCase()&&i.attach(ContentEdit.TableRow.fromDOMElement(n));return i},e}(ContentEdit.ElementCollection),ContentEdit.TableRow=function(t){function e(t){e.__super__.constructor.call(this,"tr",t)}return s(e,t),e.prototype.cssTypeName=function(){return"table-row"},e.prototype.isEmpty=function(){var t,e,n,o,i;for(i=this.children,n=0,o=i.length;o>n;n++)if(t=i[n],e=t.tableCellText(),e&&e.content.length()>0)return!1;return!0},e.prototype.type=function(){return"TableRow"},e.prototype.typeName=function(){return"Table row"},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.droppers={TableRow:ContentEdit.Element._dropVert},e.fromDOMElement=function(t){var e,n,o,i,r,s,a;for(i=new this(this.getDOMElementAttributes(t)),o=function(){var n,o,i,r;for(i=t.childNodes,r=[],n=0,o=i.length;o>n;n++)e=i[n],r.push(e);return r}(),s=0,a=o.length;a>s;s++)n=o[s],1===n.nodeType&&(r=n.tagName.toLowerCase(),("td"===r||"th"===r)&&i.attach(ContentEdit.TableCell.fromDOMElement(n)));return i},e}(ContentEdit.ElementCollection),ContentEdit.TableCell=function(t){function e(t,n){e.__super__.constructor.call(this,t,n)}return s(e,t),e.prototype.cssTypeName=function(){return"table-cell"},e.prototype.tableCellText=function(){return this.children.length>0?this.children[0]:null},e.prototype.type=function(){return"TableCell"},e.prototype.html=function(t){var e;return null==t&&(t=""),e=[""+t+"<"+this.tagName()+this._attributesToString()+">"],this.tableCellText()&&e.push(this.tableCellText().html(t+ContentEdit.INDENT)),e.push(""+t+"</"+this.tagName()+">"),e.join("\n")},e.prototype._onMouseOver=function(t){return e.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},e.prototype._addDOMEventListeners=function(){},e.prototype._removeDOMEventListners=function(){},e.fromDOMElement=function(t){var e,n;return e=new this(t.tagName,this.getDOMElementAttributes(t)),n=new ContentEdit.TableCellText(t.innerHTML.replace(/^\s+|\s+$/g,"")),e.attach(n),e},e}(ContentEdit.ElementCollection),ContentEdit.TableCellText=function(t){function e(t){e.__super__.constructor.call(this,"div",{},t)}return s(e,t),e.prototype.cssTypeName=function(){return"table-cell-text"},e.prototype.type=function(){return"TableCellText"},e.prototype._isInFirstRow=function(){var t,e,n,o;return t=this.parent(),e=t.parent(),n=e.parent(),o=n.parent(),n!==o.firstSection()?!1:e===n.children[0]},e.prototype._isInLastRow=function(){var t,e,n,o;return t=this.parent(),e=t.parent(),n=e.parent(),o=n.parent(),n!==o.lastSection()?!1:e===n.children[n.children.length-1]},e.prototype._isLastInSection=function(){var t,e,n;return t=this.parent(),e=t.parent(),n=e.parent(),e!==n.children[n.children.length-1]?!1:t===e.children[e.children.length-1]},e.prototype.blur=function(){return this.isMounted()&&(this._domElement.blur(),this._domElement.removeAttribute("contenteditable")),ContentEdit.Element.prototype.blur.call(this)},e.prototype.html=function(t){var e;return null==t&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(e=this.content.copy().trim(),e.optimize(),this._lastCached=Date.now(),this._cached=e.html()),""+t+this._cached},e.prototype._onMouseDown=function(t){var e;return ContentEdit.Element.prototype._onMouseDown.call(this,t),e=function(n){return function(){var o,i;return o=n.parent(),ContentEdit.Root.get().dragging()===o.parent()?(ContentEdit.Root.get().cancelDragging(),i=o.parent().parent().parent(),i.drag(t.pageX,t.pageY)):(o.parent().drag(t.pageX,t.pageY),n._dragTimeout=setTimeout(e,2*ContentEdit.DRAG_HOLD_DURATION))}}(this),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(e,ContentEdit.DRAG_HOLD_DURATION)},e.prototype._keyBack=function(t){var e,n,o,i;return i=ContentSelect.Range.query(this._domElement),0===i.get()[0]&&i.isCollapsed()?(t.preventDefault(),e=this.parent(),o=e.parent(),0===this.content.length()&&0===o.children.indexOf(e)&&o.isEmpty()?(n=this.previousContent(),n&&(n.focus(),i=new ContentSelect.Range(n.content.length(),n.content.length()),i.select(n.domElement())),o.parent().detach(o)):void 0):void 0},e.prototype._keyDelete=function(t){var e,n,o,i;return o=this.parent().parent(),o.isEmpty()?(t.preventDefault(),e=o.children[o.children.length-1],n=e.tableCellText().nextContent(),n&&(n.focus(),i=new ContentSelect.Range(0,0),i.select(n.domElement())),o.parent().detach(o)):void 0},e.prototype._keyDown=function(t){var e,n,o,i,r,s;return t.preventDefault(),e=this.parent(),this._isInLastRow()?(s=e.parent(),o=s.children[s.children.length-1].tableCellText(),i=o.nextContent(),i?i.focus():ContentEdit.Root.get().trigger("next-region",this.closest(function(t){return"Region"===t.type()}))):(r=e.parent().nextWithTest(function(t){return"TableRow"===t.type()}),n=e.parent().children.indexOf(e),n=Math.min(n,r.children.length),r.children[n].tableCellText().focus())},e.prototype._keyReturn=function(t){return t.preventDefault(),this._keyTab({shiftKey:!1,preventDefault:function(){}})},e.prototype._keyTab=function(t){var e,n,o,i,r,s,a,l,u,h;if(t.preventDefault(),e=this.parent(),t.shiftKey){if(this._isInFirstRow()&&e.parent().children[0]===e)return;return this.previousContent().focus()}if(o=e.parent().parent(),"tbody"===o.tagName()&&this._isLastInSection()){for(s=new ContentEdit.TableRow,h=e.parent().children,l=0,u=h.length;u>l;l++)n=h[l],i=new ContentEdit.TableCell(n.tagName(),n._attributes),r=new ContentEdit.TableCellText(""),i.attach(r),s.attach(i);return a=this.closest(function(t){return"TableSection"===t.type()}),a.attach(s),s.children[0].tableCellText().focus()}return this.nextContent().focus()},e.prototype._keyUp=function(t){var e,n,o,i,r;return t.preventDefault(),e=this.parent(),this._isInFirstRow()?(r=e.parent(),o=r.children[0].previousContent(),o?o.focus():ContentEdit.Root.get().trigger("previous-region",this.closest(function(t){return"Region"===t}))):(i=e.parent().previousWithTest(function(t){return"TableRow"===t.type()}),n=e.parent().children.indexOf(e),n=Math.min(n,i.children.length),i.children[n].tableCellText().focus())},e.droppers={},e.mergers={},e}(ContentEdit.Text)}.call(this),function(){var t,e,n,o,i=[].slice,r={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a=function(t,e){return function(){return t.apply(e,arguments)}};window.ContentTools={Tools:{},DEFAULT_TOOLS:[["bold","italic","link","align-left","align-center","align-right"],["heading","subheading","paragraph","unordered-list","ordered-list","table","indent","unindent","line-break"],["image","video","preformatted"],["undo","redo","remove"]],DEFAULT_VIDEO_HEIGHT:300,DEFAULT_VIDEO_WIDTH:400,HIGHLIGHT_HOLD_DURATION:2e3,INSPECTOR_IGNORED_ELEMENTS:["ListItemText","Region","TableCellText"],IMAGE_UPLOADER:null,MIN_CROP:10,RESTRICTED_ATTRIBUTES:{"*":["style"],img:["height","src","width","data-ce-max-width","data-ce-min-width"],iframe:["height","width"]},getEmbedVideoURL:function(t){var e,n,o,i,r,s,a,l,u,h,c,d,p,_,m;for(e={"www.youtube.com":"youtube","youtu.be":"youtube","vimeo.com":"vimeo","player.vimeo.com":"vimeo"},h=document.createElement("a"),h.href=t,s=h.hostname.toLowerCase(),c=h.pathname,null!==c&&"/"!==c.substr(0,1)&&(c="/"+c),l={},u=h.search.slice(1),m=u.split("&"),p=0,_=m.length;_>p;p++)i=m[p],i=i.split("="),i[0]&&(l[i[0]]=i[1]);switch(e[s]){case"youtube":if("/watch"===c.toLowerCase()){if(!l.v)return null;n=l.v,delete l.v}else{if(r=c.match(/\/([A-Za-z0-9_-]+)$/i),!r)return null;n=r[1]}return t="https://www.youtube.com/embed/"+n,a=function(){var t;t=[];for(o in l)d=l[o],t.push(""+o+"="+d);return t}().join("&"),a&&(t+="?"+a),t;case"vimeo":return(r=c.match(/\/(\w+\/\w+\/){0,1}(\d+)/i))?(t="https://player.vimeo.com/video/"+r[2],a=function(){var t;t=[];for(o in l)d=l[o],t.push(""+o+"="+d);return t}().join("&"),a&&(t+="?"+a),t):null}return null},getRestrictedAtributes:function(t){var e;return e=[],ContentTools.RESTRICTED_ATTRIBUTES[t]&&(e=e.concat(ContentTools.RESTRICTED_ATTRIBUTES[t])),ContentTools.RESTRICTED_ATTRIBUTES["*"]&&(e=e.concat(ContentTools.RESTRICTED_ATTRIBUTES["*"])),e}},ContentTools.ComponentUI=function(){function t(){this._bindings={},this._parent=null,this._children=[],this._domElement=null}return t.prototype.children=function(){return this._children.slice()},t.prototype.domElement=function(){return this._domElement},t.prototype.isMounted=function(){return null!==this._domElement},t.prototype.parent=function(){return this._parent},t.prototype.attach=function(t,e){return t.parent()&&t.parent().detach(t),t._parent=this,void 0!==e?this._children.splice(e,0,t):this._children.push(t)},t.prototype.addCSSClass=function(t){return this.isMounted()?ContentEdit.addCSSClass(this._domElement,t):void 0},t.prototype.detatch=function(t){var e;return e=this._children.indexOf(t),-1!==e?this._children.splice(e,1):void 0},t.prototype.mount=function(){},t.prototype.removeCSSClass=function(t){return this.isMounted()?ContentEdit.removeCSSClass(this._domElement,t):void 0},t.prototype.unmount=function(){return this.isMounted()?(this._removeDOMEventListeners(),this._domElement.parentNode.removeChild(this._domElement),this._domElement=null):void 0},t.prototype.bind=function(t,e){return void 0===this._bindings[t]&&(this._bindings[t]=[]),this._bindings[t].push(e),e},t.prototype.trigger=function(){var t,e,n,o,r,s,a;if(n=arguments[0],t=2<=arguments.length?i.call(arguments,1):[],this._bindings[n]){for(s=this._bindings[n],a=[],o=0,r=s.length;r>o;o++)e=s[o],e&&a.push(e.call.apply(e,[this].concat(i.call(t))));return a}},t.prototype.unbind=function(t,e){var n,o,i,r,s,a;if(!t)return void(this._bindings={});if(!e)return void(this._bindings[t]=void 0);if(this._bindings[t]){for(s=this._bindings[t],a=[],n=i=0,r=s.length;r>i;n=++i)o=s[n],a.push(o===e?this._bindings[t].splice(n,1):void 0);return a}},t.prototype._addDOMEventListeners=function(){},t.prototype._removeDOMEventListeners=function(){},t.createDiv=function(t,e,n){var o,i,r;if(o=document.createElement("div"),t&&t.length>0&&o.setAttribute("class",t.join(" ")),e)for(i in e)r=e[i],o.setAttribute(i,r);return n&&(o.innerHTML=n),o},t}(),ContentTools.WidgetUI=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.attach=function(t,n){return e.__super__.attach.call(this,t,n),this.isMounted()?void 0:t.mount()},e.prototype.detatch=function(t){return e.__super__.detatch.call(this,t),this.isMounted()?t.unmount():void 0},e.prototype.show=function(){var t;return this.isMounted()||this.mount(),t=function(t){return function(){return t.addCSSClass("ct-widget--active")}}(this),setTimeout(t,100)},e.prototype.hide=function(){var t;return this.removeCSSClass("ct-widget--active"),t=function(e){return function(){return window.getComputedStyle?parseFloat(window.getComputedStyle(e._domElement).opacity)<.01?e.unmount():setTimeout(t,250):void e.unmount()}}(this),this.isMounted()?setTimeout(t,250):void 0},e}(ContentTools.ComponentUI),ContentTools.AnchoredComponentUI=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.mount=function(t,e){return null==e&&(e=null),t.insertBefore(this._domElement,e),this._addDOMEventListeners()},e}(ContentTools.ComponentUI),ContentTools.FlashUI=function(t){function e(t){e.__super__.constructor.call(this),this.mount(t)}return s(e,t),e.prototype.mount=function(t){var n;return this._domElement=this.constructor.createDiv(["ct-flash","ct-flash--active","ct-flash--"+t,"ct-widget","ct-widget--active"]),e.__super__.mount.call(this,ContentTools.EditorApp.get().domElement()),n=function(t){return function(){return window.getComputedStyle?parseFloat(window.getComputedStyle(t._domElement).opacity)<.01?t.unmount():setTimeout(n,250):void t.unmount()}}(this),setTimeout(n,250)},e}(ContentTools.AnchoredComponentUI),ContentTools.IgnitionUI=function(t){function e(){e.__super__.constructor.call(this),this._busy=!1}return s(e,t),e.prototype.busy=function(t){return void 0===t?this._busy:this._busy!==t?(this._busy=t,t?this.addCSSClass("ct-ignition--busy"):this.removeCSSClass("ct-ignition--busy")):void 0},e.prototype.changeState=function(t){return"editing"===t?(this.addCSSClass("ct-ignition--editing"),this.removeCSSClass("ct-ignition--ready")):"ready"===t?(this.removeCSSClass("ct-ignition--editing"),this.addCSSClass("ct-ignition--ready")):void 0},e.prototype.mount=function(){return e.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-widget","ct-ignition","ct-ignition--ready"]),this.parent().domElement().appendChild(this._domElement),this._domEdit=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--edit"]),this._domElement.appendChild(this._domEdit),this._domConfirm=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--confirm"]),this._domElement.appendChild(this._domConfirm),this._domCancel=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--cancel"]),this._domElement.appendChild(this._domCancel),this._domBusy=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--busy"]),this._domElement.appendChild(this._domBusy),this._addDOMEventListeners()},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domEdit=null,this._domConfirm=null,this._domCancel=null},e.prototype._addDOMEventListeners=function(){return this._domEdit.addEventListener("click",function(t){return function(e){return e.preventDefault(),t.addCSSClass("ct-ignition--editing"),t.removeCSSClass("ct-ignition--ready"),t.trigger("start")}}(this)),this._domConfirm.addEventListener("click",function(t){return function(e){return e.preventDefault(),t.removeCSSClass("ct-ignition--editing"),t.addCSSClass("ct-ignition--ready"),t.trigger("stop",!0)}}(this)),this._domCancel.addEventListener("click",function(t){return function(e){return e.preventDefault(),t.removeCSSClass("ct-ignition--editing"),t.addCSSClass("ct-ignition--ready"),t.trigger("stop",!1)}}(this))},e}(ContentTools.WidgetUI),ContentTools.InspectorUI=function(t){function e(){e.__super__.constructor.call(this),this._tagUIs=[]}return s(e,t),e.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-widget","ct-inspector"]),this.parent().domElement().appendChild(this._domElement),this._domTags=this.constructor.createDiv(["ct-inspector__tags","ct-tags"]),this._domElement.appendChild(this._domTags),this._addDOMEventListeners(),this._handleFocusChange=function(t){return function(){return t.updateTags()}}(this),ContentEdit.Root.get().bind("blur",this._handleFocusChange),ContentEdit.Root.get().bind("focus",this._handleFocusChange),ContentEdit.Root.get().bind("mount",this._handleFocusChange)},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domTags=null,ContentEdit.Root.get().unbind("blur",this._handleFocusChange),ContentEdit.Root.get().unbind("focus",this._handleFocusChange),ContentEdit.Root.get().unbind("mount",this._handleFocusChange)},e.prototype.updateTags=function(){var t,e,n,o,i,r,s,a,l;for(t=ContentEdit.Root.get().focused(),a=this._tagUIs,o=0,r=a.length;r>o;o++)n=a[o],n.unmount();if(this._tagUIs=[],t){for(e=t.parents(),e.reverse(),e.push(t),l=[],i=0,s=e.length;s>i;i++)t=e[i],-1===ContentTools.INSPECTOR_IGNORED_ELEMENTS.indexOf(t.type())&&(n=new ContentTools.TagUI(t),this._tagUIs.push(n),l.push(n.mount(this._domTags)));return l}},e}(ContentTools.WidgetUI),ContentTools.TagUI=function(t){function e(t){this.element=t,this._onMouseDown=a(this._onMouseDown,this),e.__super__.constructor.call(this)}return s(e,t),e.prototype.mount=function(t,n){return null==n&&(n=null),this._domElement=this.constructor.createDiv(["ct-tag"]),this._domElement.textContent=this.element.tagName(),e.__super__.mount.call(this,t,n)},e.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("mousedown",this._onMouseDown)},e.prototype._onMouseDown=function(t){var e,n,o;return t.preventDefault(),this.element.storeState&&this.element.storeState(),e=ContentTools.EditorApp.get(),o=new ContentTools.ModalUI,n=new ContentTools.PropertiesDialog(this.element),n.bind("cancel",function(t){return function(){return n.unbind("cancel"),o.hide(),n.hide(),t.element.restoreState?t.element.restoreState():void 0}}(this)),n.bind("save",function(t){return function(e,i,r){var s,a,l,u,h,c,d,p,_,m,g,f,C;n.unbind("save");for(c in e)if(d=e[c],"class"===c){for(null===d&&(d=""),l={},f=d.split(" "),p=0,m=f.length;m>p;p++)a=f[p],a=a.trim(),a&&(l[a]=!0,t.element.hasCSSClass(a)||t.element.addCSSClass(a));for(C=t.element.attr("class").split(" "),_=0,g=C.length;g>_;_++)a=C[_],a=a.trim(),void 0===l[a]&&t.element.removeCSSClass(a)}else null===d?t.element.removeAttr(c):t.element.attr(c,d);for(u in i)s=i[u],s?t.element.addCSSClass(u):t.element.removeCSSClass(u);return null!==r&&r!==n.getElementInnerHTML()&&(h=t.element,h.content||(h=h.children[0]),h.content=new HTMLString.String(r,h.content.preserveWhitespace()),h.updateInnerHTML(),h.taint(),h.selection(new ContentSelect.Range(0,0)),h.storeState()),o.hide(),n.hide(),t.element.restoreState?t.element.restoreState():void 0}}(this)),e.attach(o),e.attach(n),o.show(),n.show()},e}(ContentTools.AnchoredComponentUI),ContentTools.ModalUI=function(t){function e(t,n){e.__super__.constructor.call(this),this._transparent=t,this._allowScrolling=n}return s(e,t),e.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-widget","ct-modal"]),this.parent().domElement().appendChild(this._domElement),this._transparent&&this.addCSSClass("ct-modal--transparent"),this._allowScrolling||ContentEdit.addCSSClass(document.body,"ct--no-scroll"),this._addDOMEventListeners()},e.prototype.unmount=function(){return this._allowScrolling||ContentEdit.removeCSSClass(document.body,"ct--no-scroll"),e.__super__.unmount.call(this)},e.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("click",function(t){return function(){return t.trigger("click")}}(this))},e}(ContentTools.WidgetUI),ContentTools.ToolboxUI=function(t){function e(t){this._onStopDragging=a(this._onStopDragging,this),this._onStartDragging=a(this._onStartDragging,this),this._onDrag=a(this._onDrag,this),e.__super__.constructor.call(this),this._tools=t,this._dragging=!1,this._draggingOffset=null,this._domGrip=null,this._toolUIs={}}return s(e,t),e.prototype.isDragging=function(){return this._dragging},e.prototype.hide=function(){return this._removeDOMEventListeners(),e.__super__.hide.call(this)},e.prototype.tools=function(t){return void 0===t?this._tools:(this._tools=t,this.unmount(),this.mount())},e.prototype.mount=function(){var t,e,n,o,i,r,s,a,l,u,h,c,d;for(this._domElement=this.constructor.createDiv(["ct-widget","ct-toolbox"]),this.parent().domElement().appendChild(this._domElement),this._domGrip=this.constructor.createDiv(["ct-toolbox__grip","ct-grip"]),this._domElement.appendChild(this._domGrip),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),d=this._tools,n=l=0,h=d.length;h>l;n=++l)for(s=d[n],e=this.constructor.createDiv(["ct-tool-group"]),this._domElement.appendChild(e),u=0,c=s.length;c>u;u++)a=s[u],r=ContentTools.ToolShelf.fetch(a),this._toolUIs[a]=new ContentTools.ToolUI(r),this._toolUIs[a].mount(e),this._toolUIs[a].disabled(!0),this._toolUIs[a].bind("apply",function(t){return function(){return t.updateTools()}}(this));return i=window.localStorage.getItem("ct-toolbox-position"),i&&/^\d+,\d+$/.test(i)&&(o=function(){var e,n,o,r;for(o=i.split(","),r=[],e=0,n=o.length;n>e;e++)t=o[e],r.push(parseInt(t));return r}(),this._domElement.style.left=""+o[0]+"px",this._domElement.style.top=""+o[1]+"px",this._contain()),this._addDOMEventListeners()},e.prototype.updateTools=function(){var t,e,n,o,i,r;t=ContentEdit.Root.get().focused(),n=null,t&&t.selection&&(n=t.selection()),i=this._toolUIs,r=[];for(e in i)o=i[e],r.push(o.update(t,n));return r},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domGrip=null},e.prototype._addDOMEventListeners=function(){return this._domGrip.addEventListener("mousedown",this._onStartDragging),this._handleResize=function(t){return function(){var e;return t._resizeTimeout&&clearTimeout(t._resizeTimeout),e=function(){return t._contain()},t._resizeTimeout=setTimeout(e,250)}}(this),window.addEventListener("resize",this._handleResize),this._updateTools=function(t){return function(){var e,n,o,i,r,s,a,l;if(e=ContentTools.EditorApp.get(),s=!1,n=ContentEdit.Root.get().focused(),i=null,n===t._lastUpdateElement?n&&n.selection&&(i=n.selection(),t._lastUpdateSelection?i.eq(t._lastUpdateSelection)||(s=!0):s=!0):s=!0,e.history&&(t._lastUpdateHistoryLength!==e.history.length()&&(s=!0),t._lastUpdateHistoryLength=e.history.length(),t._lastUpdateHistoryIndex!==e.history.index()&&(s=!0),t._lastUpdateHistoryIndex=e.history.index()),t._lastUpdateElement=n,t._lastUpdateSelection=i,s){a=t._toolUIs,l=[];for(o in a)r=a[o],l.push(r.update(n,i));return l}}}(this),this._updateToolsTimeout=setInterval(this._updateTools,100),this._handleKeyDown=function(){return function(t){var e,n,o,i,r;switch(46===t.keyCode&&(e=ContentEdit.Root.get().focused(),e&&!e.content&&ContentTools.Tools.Remove.apply(e,null,function(){})),r=navigator.appVersion,n="linux",-1!==r.indexOf("Mac")?n="mac":-1!==r.indexOf("Win")&&(n="windows"),o=!1,i=!1,n){case"linux":90===t.keyCode&&t.ctrlKey&&(o=t.shiftKey,i=!o);break;case"mac":90===t.keyCode&&t.metaKey&&(o=t.shiftKey,i=!o);
break;case"windows":89===t.keyCode&&t.ctrlKey&&(o=!0),90===t.keyCode&&t.ctrlKey&&(i=!0)}return i&&ContentTools.Tools.Undo.canApply(null,null)&&ContentTools.Tools.Undo.apply(null,null,function(){}),o&&ContentTools.Tools.Redo.canApply(null,null)?ContentTools.Tools.Redo.apply(null,null,function(){}):void 0}}(this),window.addEventListener("keydown",this._handleKeyDown)},e.prototype._contain=function(){var t;return this.isMounted()?(t=this._domElement.getBoundingClientRect(),t.left+t.width>window.innerWidth&&(this._domElement.style.left=""+(window.innerWidth-t.width)+"px"),t.top+t.height>window.innerHeight&&(this._domElement.style.top=""+(window.innerHeight-t.height)+"px"),t.left<0&&(this._domElement.style.left="0px"),t.top<0&&(this._domElement.style.top="0px"),t=this._domElement.getBoundingClientRect(),window.localStorage.setItem("ct-toolbox-position",""+t.left+","+t.top)):void 0},e.prototype._removeDOMEventListeners=function(){return this.isMounted()&&this._domGrip.removeEventListener("mousedown",this._onStartDragging),window.removeEventListener("keydown",this._handleKeyDown),window.removeEventListener("resize",this._handleResize),window.removeEventListener("resize",this._handleResize),clearInterval(this._updateToolsTimeout)},e.prototype._onDrag=function(t){return ContentSelect.Range.unselectAll(),this._domElement.style.left=""+(t.clientX-this._draggingOffset.x)+"px",this._domElement.style.top=""+(t.clientY-this._draggingOffset.y)+"px"},e.prototype._onStartDragging=function(t){var e;return t.preventDefault(),this.isDragging()?void 0:(this._dragging=!0,this.addCSSClass("ct-toolbox--dragging"),e=this._domElement.getBoundingClientRect(),this._draggingOffset={x:t.clientX-e.left,y:t.clientY-e.top},document.addEventListener("mousemove",this._onDrag),document.addEventListener("mouseup",this._onStopDragging),ContentEdit.addCSSClass(document.body,"ce--dragging"))},e.prototype._onStopDragging=function(){return this.isDragging()?(this._contain(),document.removeEventListener("mousemove",this._onDrag),document.removeEventListener("mouseup",this._onStopDragging),this._draggingOffset=null,this._dragging=!1,this.removeCSSClass("ct-toolbox--dragging"),ContentEdit.removeCSSClass(document.body,"ce--dragging")):void 0},e}(ContentTools.WidgetUI),ContentTools.ToolUI=function(t){function e(t){this._onMouseUp=a(this._onMouseUp,this),this._onMouseLeave=a(this._onMouseLeave,this),this._onMouseDown=a(this._onMouseDown,this),this._addDOMEventListeners=a(this._addDOMEventListeners,this),e.__super__.constructor.call(this),this.tool=t,this._mouseDown=!1,this._disabled=!1}return s(e,t),e.prototype.apply=function(t,e){var n;return this.tool.canApply(t,e)?(n=function(t){return function(e){return e?t.trigger("apply"):void 0}}(this),this.tool.apply(t,e,n)):void 0},e.prototype.disabled=function(t){return void 0===t?this._disabled:this._disabled!==t?(this._disabled=t,t?(this._mouseDown=!1,this.addCSSClass("ct-tool--disabled"),this.removeCSSClass("ct-tool--applied")):this.removeCSSClass("ct-tool--disabled")):void 0},e.prototype.mount=function(t,n){return null==n&&(n=null),this._domElement=this.constructor.createDiv(["ct-tool","ct-tool--"+this.tool.icon]),this._domElement.setAttribute("data-tooltip",ContentEdit._(this.tool.label)),e.__super__.mount.call(this,t,n)},e.prototype.update=function(t,e){return(!this.tool.requiresElement||t&&t.isMounted())&&this.tool.canApply(t,e)?(this.disabled(!1),this.tool.isApplied(t,e)?this.addCSSClass("ct-tool--applied"):this.removeCSSClass("ct-tool--applied")):void this.disabled(!0)},e.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("mousedown",this._onMouseDown),this._domElement.addEventListener("mouseleave",this._onMouseLeave),this._domElement.addEventListener("mouseup",this._onMouseUp)},e.prototype._onMouseDown=function(t){return t.preventDefault(),this.disabled()?void 0:(this._mouseDown=!0,this.addCSSClass("ct-tool--down"))},e.prototype._onMouseLeave=function(){return this._mouseDown=!1,this.removeCSSClass("ct-tool--down")},e.prototype._onMouseUp=function(){var t,e;if(this._mouseDown){if(t=ContentEdit.Root.get().focused(),this.tool.requiresElement&&(!t||!t.isMounted()))return;e=null,t&&t.selection&&(e=t.selection()),this.apply(t,e)}return this._mouseDown=!1,this.removeCSSClass("ct-tool--down")},e}(ContentTools.AnchoredComponentUI),ContentTools.AnchoredDialogUI=function(t){function e(){e.__super__.constructor.call(this),this._position=[0,0]}return s(e,t),e.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-widget","ct-anchored-dialog"]),this.parent().domElement().appendChild(this._domElement),this._domElement.style.top=""+this._position[1]+"px",this._domElement.style.left=""+this._position[0]+"px"},e.prototype.position=function(t){return void 0===t?this._position.slice():(this._position=t.slice(),this.isMounted()?(this._domElement.style.top=""+this._position[1]+"px",this._domElement.style.left=""+this._position[0]+"px"):void 0)},e}(ContentTools.WidgetUI),ContentTools.DialogUI=function(t){function e(t){null==t&&(t=""),e.__super__.constructor.call(this),this._busy=!1,this._caption=t}return s(e,t),e.prototype.busy=function(t){return void 0===t?this._busy:this._busy!==t&&(this._busy=t,this.isMounted())?this._busy?ContentEdit.addCSSClass(this._domElement,"ct-dialog--busy"):ContentEdit.removeCSSClass(this._domElement,"ct-dialog--busy"):void 0},e.prototype.caption=function(t){return void 0===t?this._caption:(this._caption=t,this._domCaption.textContent=ContentEdit._(t))},e.prototype.mount=function(){var t,e,n;return t=["ct-widget","ct-dialog"],this._busy&&t.push("ct-dialog--busy"),this._domElement=this.constructor.createDiv(t),this.parent().domElement().appendChild(this._domElement),n=this.constructor.createDiv(["ct-dialog__header"]),this._domElement.appendChild(n),this._domCaption=this.constructor.createDiv(["ct-dialog__caption"]),n.appendChild(this._domCaption),this.caption(this._caption),this._domClose=this.constructor.createDiv(["ct-dialog__close"]),n.appendChild(this._domClose),e=this.constructor.createDiv(["ct-dialog__body"]),this._domElement.appendChild(e),this._domView=this.constructor.createDiv(["ct-dialog__view"]),e.appendChild(this._domView),this._domControls=this.constructor.createDiv(["ct-dialog__controls"]),e.appendChild(this._domControls),this._domBusy=this.constructor.createDiv(["ct-dialog__busy"]),this._domElement.appendChild(this._domBusy)},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domBusy=null,this._domCaption=null,this._domClose=null,this._domControls=null,this._domView=null},e.prototype._addDOMEventListeners=function(){return this._handleEscape=function(t){return function(e){return t._busy?void 0:27===e.keyCode?t.trigger("cancel"):void 0}}(this),document.addEventListener("keyup",this._handleEscape),this._domClose.addEventListener("click",function(t){return function(e){return e.preventDefault(),t._busy?void 0:t.trigger("cancel")}}(this))},e.prototype._removeDOMEventListeners=function(){return document.removeEventListener("keyup",this._handleEscape)},e}(ContentTools.WidgetUI),ContentTools.ImageDialog=function(t){function n(){n.__super__.constructor.call(this,"Insert image"),this._cropMarks=null,this._imageURL=null,this._imageSize=null,this._progress=0,this._state="empty",ContentTools.IMAGE_UPLOADER&&ContentTools.IMAGE_UPLOADER(this)}return s(n,t),n.prototype.cropRegion=function(){return this._cropMarks?this._cropMarks.region():[0,0,1,1]},n.prototype.addCropMarks=function(){return this._cropMarks?void 0:(this._cropMarks=new e(this._imageSize),this._cropMarks.mount(this._domView),ContentEdit.addCSSClass(this._domCrop,"ct-control--active"))},n.prototype.clear=function(){return this._domImage&&(this._domImage.parentNode.removeChild(this._domImage),this._domImage=null),this._imageURL=null,this._imageSize=null,this.state("empty")},n.prototype.mount=function(){var t,e,o;return n.__super__.mount.call(this),ContentEdit.addCSSClass(this._domElement,"ct-image-dialog"),ContentEdit.addCSSClass(this._domElement,"ct-image-dialog--empty"),ContentEdit.addCSSClass(this._domView,"ct-image-dialog__view"),o=this.constructor.createDiv(["ct-control-group","ct-control-group--left"]),this._domControls.appendChild(o),this._domRotateCCW=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--rotate-ccw"]),this._domRotateCCW.setAttribute("data-tooltip",ContentEdit._("Rotate")+" -90°"),o.appendChild(this._domRotateCCW),this._domRotateCW=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--rotate-cw"]),this._domRotateCW.setAttribute("data-tooltip",ContentEdit._("Rotate")+" 90°"),o.appendChild(this._domRotateCW),this._domCrop=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--crop"]),this._domCrop.setAttribute("data-tooltip",ContentEdit._("Crop marks")),o.appendChild(this._domCrop),e=this.constructor.createDiv(["ct-progress-bar"]),o.appendChild(e),this._domProgress=this.constructor.createDiv(["ct-progress-bar__progress"]),e.appendChild(this._domProgress),t=this.constructor.createDiv(["ct-control-group","ct-control-group--right"]),this._domControls.appendChild(t),this._domUpload=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--upload"]),this._domUpload.textContent=ContentEdit._("Upload"),t.appendChild(this._domUpload),this._domInput=document.createElement("input"),this._domInput.setAttribute("class","ct-image-dialog__file-upload"),this._domInput.setAttribute("name","file"),this._domInput.setAttribute("type","file"),this._domInput.setAttribute("accept","image/*"),this._domUpload.appendChild(this._domInput),this._domInsert=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--insert"]),this._domInsert.textContent=ContentEdit._("Insert"),t.appendChild(this._domInsert),this._domCancelUpload=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--cancel"]),this._domCancelUpload.textContent=ContentEdit._("Cancel"),t.appendChild(this._domCancelUpload),this._domClear=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--clear"]),this._domClear.textContent=ContentEdit._("Clear"),t.appendChild(this._domClear),this._addDOMEventListeners(),this.trigger("imageUploader.mount")},n.prototype.populate=function(t,e){return this._imageURL=t,this._imageSize=e,this._domImage||(this._domImage=this.constructor.createDiv(["ct-image-dialog__image"]),this._domView.appendChild(this._domImage)),this._domImage.style["background-image"]="url("+t+")",this.state("populated")},n.prototype.progress=function(t){return void 0===t?this._progress:(this._progress=t,this.isMounted()?this._domProgress.style.width=""+this._progress+"%":void 0)},n.prototype.removeCropMarks=function(){return this._cropMarks?(this._cropMarks.unmount(),this._cropMarks=null,ContentEdit.removeCSSClass(this._domCrop,"ct-control--active")):void 0},n.prototype.save=function(t,e,n){return this.trigger("save",t,e,n)},n.prototype.state=function(t){var e;return void 0===t?this._state:this._state!==t&&(e=this._state,this._state=t,this.isMounted())?(ContentEdit.addCSSClass(this._domElement,"ct-image-dialog--"+this._state),ContentEdit.removeCSSClass(this._domElement,"ct-image-dialog--"+e)):void 0},n.prototype.unmount=function(){return n.__super__.unmount.call(this),this._domCancelUpload=null,this._domClear=null,this._domCrop=null,this._domInput=null,this._domInsert=null,this._domProgress=null,this._domRotateCCW=null,this._domRotateCW=null,this._domUpload=null,this.trigger("imageUploader.unmount")},n.prototype._addDOMEventListeners=function(){return n.__super__._addDOMEventListeners.call(this),this._domInput.addEventListener("change",function(t){return function(e){var n;return n=e.target.files[0],e.target.value="",e.target.value&&(e.target.type="text",e.target.type="file"),t.trigger("imageUploader.fileReady",n)}}(this)),this._domCancelUpload.addEventListener("click",function(t){return function(){return t.trigger("imageUploader.cancelUpload")}}(this)),this._domClear.addEventListener("click",function(t){return function(){return t.removeCropMarks(),t.trigger("imageUploader.clear")}}(this)),this._domRotateCCW.addEventListener("click",function(t){return function(){return t.removeCropMarks(),t.trigger("imageUploader.rotateCCW")}}(this)),this._domRotateCW.addEventListener("click",function(t){return function(){return t.removeCropMarks(),t.trigger("imageUploader.rotateCW")}}(this)),this._domCrop.addEventListener("click",function(t){return function(){return t._cropMarks?t.removeCropMarks():t.addCropMarks()}}(this)),this._domInsert.addEventListener("click",function(t){return function(){return t.trigger("imageUploader.save")}}(this))},n}(ContentTools.DialogUI),e=function(t){function e(t){e.__super__.constructor.call(this),this._bounds=null,this._dragging=null,this._draggingOrigin=null,this._imageSize=t}return s(e,t),e.prototype.mount=function(t,n){return null==n&&(n=null),this._domElement=this.constructor.createDiv(["ct-crop-marks"]),this._domClipper=this.constructor.createDiv(["ct-crop-marks__clipper"]),this._domElement.appendChild(this._domClipper),this._domRulers=[this.constructor.createDiv(["ct-crop-marks__ruler","ct-crop-marks__ruler--top-left"]),this.constructor.createDiv(["ct-crop-marks__ruler","ct-crop-marks__ruler--bottom-right"])],this._domClipper.appendChild(this._domRulers[0]),this._domClipper.appendChild(this._domRulers[1]),this._domHandles=[this.constructor.createDiv(["ct-crop-marks__handle","ct-crop-marks__handle--top-left"]),this.constructor.createDiv(["ct-crop-marks__handle","ct-crop-marks__handle--bottom-right"])],this._domElement.appendChild(this._domHandles[0]),this._domElement.appendChild(this._domHandles[1]),e.__super__.mount.call(this,t,n),this._fit(t)},e.prototype.region=function(){return[parseFloat(this._domHandles[0].style.top)/this._bounds[1],parseFloat(this._domHandles[0].style.left)/this._bounds[0],parseFloat(this._domHandles[1].style.top)/this._bounds[1],parseFloat(this._domHandles[1].style.left)/this._bounds[0]]},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domClipper=null,this._domHandles=null,this._domRulers=null},e.prototype._addDOMEventListeners=function(){return e.__super__._addDOMEventListeners.call(this),this._domHandles[0].addEventListener("mousedown",function(t){return function(e){return 0===e.button?t._startDrag(0,e.clientY,e.clientX):void 0}}(this)),this._domHandles[1].addEventListener("mousedown",function(t){return function(e){return 0===e.button?t._startDrag(1,e.clientY,e.clientX):void 0}}(this))},e.prototype._drag=function(t,e){var n,o,i,r,s;return null!==this._dragging?(ContentSelect.Range.unselectAll(),r=t-this._draggingOrigin[1],i=e-this._draggingOrigin[0],n=this._bounds[1],e=0,t=0,s=this._bounds[0],o=Math.min(Math.min(ContentTools.MIN_CROP,n),s),0===this._dragging?(n=parseInt(this._domHandles[1].style.top)-o,s=parseInt(this._domHandles[1].style.left)-o):(e=parseInt(this._domHandles[0].style.left)+o,t=parseInt(this._domHandles[0].style.top)+o),r=Math.min(Math.max(t,r),n),i=Math.min(Math.max(e,i),s),this._domHandles[this._dragging].style.top=""+r+"px",this._domHandles[this._dragging].style.left=""+i+"px",this._domRulers[this._dragging].style.top=""+r+"px",this._domRulers[this._dragging].style.left=""+i+"px"):void 0},e.prototype._fit=function(t){var e,n,o,i,r,s,a,l;return r=t.getBoundingClientRect(),l=r.width/this._imageSize[0],n=r.height/this._imageSize[1],i=Math.min(l,n),a=i*this._imageSize[0],e=i*this._imageSize[1],o=(r.width-a)/2,s=(r.height-e)/2,this._domElement.style.width=""+a+"px",this._domElement.style.height=""+e+"px",this._domElement.style.top=""+s+"px",this._domElement.style.left=""+o+"px",this._domHandles[0].style.top="0px",this._domHandles[0].style.left="0px",this._domHandles[1].style.top=""+e+"px",this._domHandles[1].style.left=""+a+"px",this._domRulers[0].style.top="0px",this._domRulers[0].style.left="0px",this._domRulers[1].style.top=""+e+"px",this._domRulers[1].style.left=""+a+"px",this._bounds=[a,e]},e.prototype._startDrag=function(t,e,n){var o;return o=this._domHandles[t],this._dragging=t,this._draggingOrigin=[n-parseInt(o.style.left),e-parseInt(o.style.top)],this._onMouseMove=function(t){return function(e){return t._drag(e.clientY,e.clientX)}}(this),document.addEventListener("mousemove",this._onMouseMove),this._onMouseUp=function(t){return function(){return t._stopDrag()}}(this),document.addEventListener("mouseup",this._onMouseUp)},e.prototype._stopDrag=function(){return document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this._dragging=null,this._draggingOrigin=null},e}(ContentTools.AnchoredComponentUI),ContentTools.LinkDialog=function(t){function e(t,n){null==t&&(t=""),null==n&&(n=""),e.__super__.constructor.call(this),this._href=t,this._target=n}var n;return s(e,t),n="_blank",e.prototype.mount=function(){return e.__super__.mount.call(this),this._domInput=document.createElement("input"),this._domInput.setAttribute("class","ct-anchored-dialog__input"),this._domInput.setAttribute("name","href"),this._domInput.setAttribute("placeholder",ContentEdit._("Enter a link")+"..."),this._domInput.setAttribute("type","text"),this._domInput.setAttribute("value",this._href),this._domElement.appendChild(this._domInput),this._domTargetButton=this.constructor.createDiv(["ct-anchored-dialog__target-button"]),this._domElement.appendChild(this._domTargetButton),this._target===n&&ContentEdit.addCSSClass(this._domTargetButton,"ct-anchored-dialog__target-button--active"),this._domButton=this.constructor.createDiv(["ct-anchored-dialog__button"]),this._domElement.appendChild(this._domButton),this._addDOMEventListeners()},e.prototype.save=function(){var t;return this.isMounted?(t={},t.href=this._domInput.value.trim(),this._target&&(t.target=this._target),this.trigger("save",t)):this.trigger("save","")},e.prototype.show=function(){return e.__super__.show.call(this),this._domInput.focus(),this._href?this._domInput.select():void 0},e.prototype.unmount=function(){return this.isMounted()&&this._domInput.blur(),e.__super__.unmount.call(this),this._domButton=null,this._domInput=null},e.prototype._addDOMEventListeners=function(){return this._domInput.addEventListener("keypress",function(t){return function(e){return 13===e.keyCode?t.save():void 0}}(this)),this._domTargetButton.addEventListener("click",function(t){return function(e){return e.preventDefault(),t._target===n?(t._target="",ContentEdit.removeCSSClass(t._domTargetButton,"ct-anchored-dialog__target-button--active")):(t._target=n,ContentEdit.addCSSClass(t._domTargetButton,"ct-anchored-dialog__target-button--active"))}}(this)),this._domButton.addEventListener("click",function(t){return function(e){return e.preventDefault(),t.save()}}(this))},e}(ContentTools.AnchoredDialogUI),ContentTools.PropertiesDialog=function(e){function o(t){var e;this.element=t,o.__super__.constructor.call(this,"Properties"),this._attributeUIs=[],this._focusedAttributeUI=null,this._styleUIs=[],this._supportsCoding=this.element.content,("ListItem"===(e=this.element.type())||"TableCell"===e)&&(this._supportsCoding=!0)}return s(o,e),o.prototype.caption=function(t){return void 0===t?this._caption:(this._caption=t,this._domCaption.textContent=ContentEdit._(t)+(": "+this.element.tagName()))},o.prototype.changedAttributes=function(){var t,e,n,o,i,r,s,a,l,u;for(e={},n={},l=this._attributeUIs,s=0,a=l.length;a>s;s++)t=l[s],o=t.name(),r=t.value(),""!==o&&(e[o.toLowerCase()]=!0,this.element.attr(o)!==r&&(n[o]=r));i=ContentTools.getRestrictedAtributes(this.element.tagName()),u=this.element.attributes();for(o in u)r=u[o],i&&-1!==i.indexOf(o.toLowerCase())||void 0===e[o]&&(n[o]=null);return n},o.prototype.changedStyles=function(){var t,e,n,o,i,r;for(n={},r=this._styleUIs,o=0,i=r.length;i>o;o++)e=r[o],t=e.style.cssClass(),this.element.hasCSSClass(t)!==e.applied()&&(n[t]=e.applied());return n},o.prototype.getElementInnerHTML=function(){return this._supportsCoding?this.element.content?this.element.content.html():this.element.children[0].content.html():null},o.prototype.mount=function(){var t,e,i,r,s,a,l,u,h,c,d,p,_,m,g;for(o.__super__.mount.call(this),ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog"),ContentEdit.addCSSClass(this._domView,"ct-properties-dialog__view"),this._domStyles=this.constructor.createDiv(["ct-properties-dialog__styles"]),this._domStyles.setAttribute("data-ct-empty",ContentEdit._("No styles available for this tag")),this._domView.appendChild(this._domStyles),g=ContentTools.StylePalette.styles(this.element.tagName()),d=0,_=g.length;_>d;d++)u=g[d],h=new n(u,this.element.hasCSSClass(u.cssClass())),this._styleUIs.push(h),h.mount(this._domStyles);this._domAttributes=this.constructor.createDiv(["ct-properties-dialog__attributes"]),this._domView.appendChild(this._domAttributes),l=ContentTools.getRestrictedAtributes(this.element.tagName()),e=this.element.attributes(),t=[];for(a in e)c=e[a],l&&-1!==l.indexOf(a.toLowerCase())||t.push(a);for(t.sort(),p=0,m=t.length;m>p;p++)a=t[p],c=e[a],this._addAttributeUI(a,c);return this._addAttributeUI("",""),this._domCode=this.constructor.createDiv(["ct-properties-dialog__code"]),this._domView.appendChild(this._domCode),this._domInnerHTML=document.createElement("textarea"),this._domInnerHTML.setAttribute("class","ct-properties-dialog__inner-html"),this._domInnerHTML.setAttribute("name","code"),this._domInnerHTML.value=this.getElementInnerHTML(),this._domCode.appendChild(this._domInnerHTML),r=this.constructor.createDiv(["ct-control-group","ct-control-group--left"]),this._domControls.appendChild(r),this._domStylesTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--styles"]),this._domStylesTab.setAttribute("data-tooltip",ContentEdit._("Styles")),r.appendChild(this._domStylesTab),this._domAttributesTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--attributes"]),this._domAttributesTab.setAttribute("data-tooltip",ContentEdit._("Attributes")),r.appendChild(this._domAttributesTab),this._domCodeTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--code"]),this._domCodeTab.setAttribute("data-tooltip",ContentEdit._("Code")),r.appendChild(this._domCodeTab),this._supportsCoding||ContentEdit.addCSSClass(this._domCodeTab,"ct-control--muted"),this._domRemoveAttribute=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--remove","ct-control--muted"]),this._domRemoveAttribute.setAttribute("data-tooltip",ContentEdit._("Remove")),r.appendChild(this._domRemoveAttribute),i=this.constructor.createDiv(["ct-control-group","ct-control-group--right"]),this._domControls.appendChild(i),this._domApply=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--apply"]),this._domApply.textContent=ContentEdit._("Apply"),i.appendChild(this._domApply),s=window.localStorage.getItem("ct-properties-dialog-tab"),"attributes"===s?(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--attributes"),ContentEdit.addCSSClass(this._domAttributesTab,"ct-control--active")):"code"===s&&this._supportsCoding?(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--code"),ContentEdit.addCSSClass(this._domCodeTab,"ct-control--active")):(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--styles"),ContentEdit.addCSSClass(this._domStylesTab,"ct-control--active")),this._addDOMEventListeners()},o.prototype.save=function(){var t;return t=null,this._supportsCoding&&(t=this._domInnerHTML.value),this.trigger("save",this.changedAttributes(),this.changedStyles(),t)},o.prototype._addAttributeUI=function(e,n){var o,i;return i=this,o=new t(e,n),this._attributeUIs.push(o),o.bind("blur",function(){var t,e,n;return i._focusedAttributeUI=null,ContentEdit.addCSSClass(i._domRemoveAttribute,"ct-control--muted"),t=i._attributeUIs.indexOf(this),n=i._attributeUIs.length,""===this.name()&&n-1>t&&(this.unmount(),i._attributeUIs.splice(t,1)),e=i._attributeUIs[n-1],e&&e.name()&&e.value()?i._addAttributeUI("",""):void 0}),o.bind("focus",function(){return i._focusedAttributeUI=this,ContentEdit.removeCSSClass(i._domRemoveAttribute,"ct-control--muted")}),o.bind("namechange",function(){var t,n,o,r,s,a,l;for(t=i.element,e=this.name().toLowerCase(),o=ContentTools.getRestrictedAtributes(t.tagName()),r=!0,o&&-1!==o.indexOf(e)&&(r=!1),l=i._attributeUIs,s=0,a=l.length;a>s;s++)n=l[s],""!==e&&n!==this&&n.name().toLowerCase()===e&&(r=!1);return this.valid(r),r?ContentEdit.removeCSSClass(i._domApply,"ct-control--muted"):ContentEdit.addCSSClass(i._domApply,"ct-control--muted")}),o.mount(this._domAttributes),o},o.prototype._addDOMEventListeners=function(){var t,e;return o.__super__._addDOMEventListeners.call(this),t=function(t){return function(e){var n,o,i,r,s,a;for(r=["attributes","code","styles"],s=0,a=r.length;a>s;s++)o=r[s],o!==e&&(i=o.charAt(0).toUpperCase()+o.slice(1),ContentEdit.removeCSSClass(t._domElement,"ct-properties-dialog--"+o),ContentEdit.removeCSSClass(t["_dom"+i+"Tab"],"ct-control--active"));return n=e.charAt(0).toUpperCase()+e.slice(1),ContentEdit.addCSSClass(t._domElement,"ct-properties-dialog--"+e),ContentEdit.addCSSClass(t["_dom"+n+"Tab"],"ct-control--active"),window.localStorage.setItem("ct-properties-dialog-tab",e)}}(this),this._domStylesTab.addEventListener("mousedown",function(){return function(){return t("styles")}}(this)),this._domAttributesTab.addEventListener("mousedown",function(){return function(){return t("attributes")}}(this)),this._domCodeTab.addEventListener("mousedown",function(){return function(){return t("code")}}(this)),this._domRemoveAttribute.addEventListener("mousedown",function(t){return function(e){var n,o;return e.preventDefault(),t._focusedAttributeUI&&(n=t._attributeUIs.indexOf(t._focusedAttributeUI),o=n===t._attributeUIs.length-1,t._focusedAttributeUI.unmount(),t._attributeUIs.splice(n,1),o)?t._addAttributeUI("",""):void 0}}(this)),e=function(t){return function(){var e;try{return e=new HTMLString.String(t._domInnerHTML.value),ContentEdit.removeCSSClass(t._domInnerHTML,"ct-properties-dialog__inner-html--invalid"),ContentEdit.removeCSSClass(t._domApply,"ct-control--muted")}catch(n){return ContentEdit.addCSSClass(t._domInnerHTML,"ct-properties-dialog__inner-html--invalid"),ContentEdit.addCSSClass(t._domApply,"ct-control--muted")}}}(this),this._domInnerHTML.addEventListener("input",e),this._domInnerHTML.addEventListener("propertychange",e),this._domApply.addEventListener("click",function(t){return function(e){var n;return e.preventDefault(),n=t._domApply.getAttribute("class"),-1===n.indexOf("ct-control--muted")?t.save():void 0}}(this))},o}(ContentTools.DialogUI),n=function(t){function e(t,n){this.style=t,e.__super__.constructor.call(this),this._applied=n}return s(e,t),e.prototype.applied=function(t){return void 0===t?this._applied:this._applied!==t?(this._applied=t,this._applied?ContentEdit.addCSSClass(this._domElement,"ct-section--applied"):ContentEdit.removeCSSClass(this._domElement,"ct-section--applied")):void 0},e.prototype.mount=function(t,n){var o;return null==n&&(n=null),this._domElement=this.constructor.createDiv(["ct-section"]),this._applied&&ContentEdit.addCSSClass(this._domElement,"ct-section--applied"),o=this.constructor.createDiv(["ct-section__label"]),o.textContent=this.style.name(),this._domElement.appendChild(o),this._domElement.appendChild(this.constructor.createDiv(["ct-section__switch"])),e.__super__.mount.call(this,t,n)},e.prototype._addDOMEventListeners=function(){var t;return t=function(t){return function(e){return e.preventDefault(),t.applied(t.applied()?!1:!0)}}(this),this._domElement.addEventListener("click",t)},e}(ContentTools.AnchoredComponentUI),t=function(t){function e(t,n){e.__super__.constructor.call(this),this._initialName=t,this._initialValue=n}return s(e,t),e.prototype.name=function(){return this._domName.value.trim()},e.prototype.value=function(){return this._domValue.value.trim()},e.prototype.mount=function(t,n){return null==n&&(n=null),this._domElement=this.constructor.createDiv(["ct-attribute"]),this._domName=document.createElement("input"),this._domName.setAttribute("class","ct-attribute__name"),this._domName.setAttribute("name","name"),this._domName.setAttribute("placeholder",ContentEdit._("Name")),this._domName.setAttribute("type","text"),this._domName.setAttribute("value",this._initialName),this._domElement.appendChild(this._domName),this._domValue=document.createElement("input"),this._domValue.setAttribute("class","ct-attribute__value"),this._domValue.setAttribute("name","value"),this._domValue.setAttribute("placeholder",ContentEdit._("Value")),this._domValue.setAttribute("type","text"),this._domValue.setAttribute("value",this._initialValue),this._domElement.appendChild(this._domValue),e.__super__.mount.call(this,t,n)},e.prototype.valid=function(t){return t?ContentEdit.removeCSSClass(this._domName,"ct-attribute__name--invalid"):ContentEdit.addCSSClass(this._domName,"ct-attribute__name--invalid")},e.prototype._addDOMEventListeners=function(){return this._domName.addEventListener("blur",function(t){return function(){var e,n,o;return e=t.name(),n=t._domElement.nextSibling,t.trigger("blur"),""===e&&n?(o=n.querySelector(".ct-attribute__name"),o.focus()):void 0}}(this)),this._domName.addEventListener("focus",function(t){return function(){return t.trigger("focus")}}(this)),this._domName.addEventListener("input",function(t){return function(){return t.trigger("namechange")}}(this)),this._domName.addEventListener("keydown",function(t){return function(e){return 13===e.keyCode?t._domValue.focus():void 0}}(this)),this._domValue.addEventListener("blur",function(t){return function(){return t.trigger("blur")}}(this)),this._domValue.addEventListener("focus",function(t){return function(){return t.trigger("focus")}}(this)),this._domValue.addEventListener("keydown",function(t){return function(e){var n,o;return 13===e.keyCode||9===e.keyCode&&!e.shiftKey?(e.preventDefault(),n=t._domElement.nextSibling,n||(t._domValue.blur(),n=t._domElement.nextSibling),n?(o=n.querySelector(".ct-attribute__name"),o.focus()):void 0):void 0}}(this))},e}(ContentTools.AnchoredComponentUI),ContentTools.TableDialog=function(t){function e(t){this.table=t,this.table?e.__super__.constructor.call(this,"Update table"):e.__super__.constructor.call(this,"Insert table")}return s(e,t),e.prototype.mount=function(){var t,n,o,i,r,s,a;return e.__super__.mount.call(this),t={columns:3,foot:!1,head:!0},this.table&&(t={columns:this.table.firstSection().children[0].children.length,foot:this.table.tfoot(),head:this.table.thead()}),ContentEdit.addCSSClass(this._domElement,"ct-table-dialog"),ContentEdit.addCSSClass(this._domView,"ct-table-dialog__view"),a=["ct-section"],t.head&&a.push("ct-section--applied"),this._domHeadSection=this.constructor.createDiv(a),this._domView.appendChild(this._domHeadSection),r=this.constructor.createDiv(["ct-section__label"]),r.textContent=ContentEdit._("Table head"),this._domHeadSection.appendChild(r),this._domHeadSwitch=this.constructor.createDiv(["ct-section__switch"]),this._domHeadSection.appendChild(this._domHeadSwitch),this._domBodySection=this.constructor.createDiv(["ct-section","ct-section--applied","ct-section--contains-input"]),this._domView.appendChild(this._domBodySection),n=this.constructor.createDiv(["ct-section__label"]),n.textContent=ContentEdit._("Table body (columns)"),this._domBodySection.appendChild(n),this._domBodyInput=document.createElement("input"),this._domBodyInput.setAttribute("class","ct-section__input"),this._domBodyInput.setAttribute("maxlength","2"),this._domBodyInput.setAttribute("name","columns"),this._domBodyInput.setAttribute("type","text"),this._domBodyInput.setAttribute("value",t.columns),this._domBodySection.appendChild(this._domBodyInput),s=["ct-section"],t.foot&&s.push("ct-section--applied"),this._domFootSection=this.constructor.createDiv(s),this._domView.appendChild(this._domFootSection),i=this.constructor.createDiv(["ct-section__label"]),
i.textContent=ContentEdit._("Table foot"),this._domFootSection.appendChild(i),this._domFootSwitch=this.constructor.createDiv(["ct-section__switch"]),this._domFootSection.appendChild(this._domFootSwitch),o=this.constructor.createDiv(["ct-control-group","ct-control-group--right"]),this._domControls.appendChild(o),this._domApply=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--apply"]),this._domApply.textContent="Apply",o.appendChild(this._domApply),this._addDOMEventListeners()},e.prototype.save=function(){var t,e,n;return t=this._domFootSection.getAttribute("class"),e=this._domHeadSection.getAttribute("class"),n={columns:parseInt(this._domBodyInput.value),foot:t.indexOf("ct-section--applied")>-1,head:e.indexOf("ct-section--applied")>-1},this.trigger("save",n)},e.prototype.unmount=function(){return e.__super__.unmount.call(this),this._domBodyInput=null,this._domBodySection=null,this._domApply=null,this._domHeadSection=null,this._domHeadSwitch=null,this._domFootSection=null,this._domFootSwitch=null},e.prototype._addDOMEventListeners=function(){var t;return e.__super__._addDOMEventListeners.call(this),t=function(t){return t.preventDefault(),this.getAttribute("class").indexOf("ct-section--applied")>-1?ContentEdit.removeCSSClass(this,"ct-section--applied"):ContentEdit.addCSSClass(this,"ct-section--applied")},this._domHeadSection.addEventListener("click",t),this._domFootSection.addEventListener("click",t),this._domBodySection.addEventListener("click",function(t){return function(){return t._domBodyInput.focus()}}(this)),this._domBodyInput.addEventListener("input",function(t){return function(e){var n;return n=/^[1-9]\d{0,1}$/.test(e.target.value),n?(ContentEdit.removeCSSClass(t._domBodyInput,"ct-section__input--invalid"),ContentEdit.removeCSSClass(t._domApply,"ct-control--muted")):(ContentEdit.addCSSClass(t._domBodyInput,"ct-section__input--invalid"),ContentEdit.addCSSClass(t._domApply,"ct-control--muted"))}}(this)),this._domApply.addEventListener("click",function(t){return function(e){var n;return e.preventDefault(),n=t._domApply.getAttribute("class"),-1===n.indexOf("ct-control--muted")?t.save():void 0}}(this))},e}(ContentTools.DialogUI),ContentTools.VideoDialog=function(t){function e(){e.__super__.constructor.call(this,"Insert video")}return s(e,t),e.prototype.clearPreview=function(){return this._domPreview?(this._domPreview.parentNode.removeChild(this._domPreview),this._domPreview=void 0):void 0},e.prototype.mount=function(){var t;return e.__super__.mount.call(this),ContentEdit.addCSSClass(this._domElement,"ct-video-dialog"),ContentEdit.addCSSClass(this._domView,"ct-video-dialog__preview"),t=this.constructor.createDiv(["ct-control-group"]),this._domControls.appendChild(t),this._domInput=document.createElement("input"),this._domInput.setAttribute("class","ct-video-dialog__input"),this._domInput.setAttribute("name","url"),this._domInput.setAttribute("placeholder",ContentEdit._("Paste YouTube or Vimeo URL")+"..."),this._domInput.setAttribute("type","text"),t.appendChild(this._domInput),this._domButton=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--insert","ct-control--muted"]),this._domButton.textContent=ContentEdit._("Insert"),t.appendChild(this._domButton),this._addDOMEventListeners()},e.prototype.preview=function(t){return this.clearPreview(),this._domPreview=document.createElement("iframe"),this._domPreview.setAttribute("frameborder","0"),this._domPreview.setAttribute("height","100%"),this._domPreview.setAttribute("src",t),this._domPreview.setAttribute("width","100%"),this._domView.appendChild(this._domPreview)},e.prototype.save=function(){var t,e;return e=this._domInput.value.trim(),t=ContentTools.getEmbedVideoURL(e),t?this.trigger("save",t):this.trigger("save",e)},e.prototype.show=function(){return e.__super__.show.call(this),this._domInput.focus()},e.prototype.unmount=function(){return this.isMounted()&&this._domInput.blur(),e.__super__.unmount.call(this),this._domButton=null,this._domInput=null,this._domPreview=null},e.prototype._addDOMEventListeners=function(){return e.__super__._addDOMEventListeners.call(this),this._domInput.addEventListener("input",function(t){return function(e){var n;return e.target.value?ContentEdit.removeCSSClass(t._domButton,"ct-control--muted"):ContentEdit.addCSSClass(t._domButton,"ct-control--muted"),t._updatePreviewTimeout&&clearTimeout(t._updatePreviewTimeout),n=function(){var e,n;return n=t._domInput.value.trim(),e=ContentTools.getEmbedVideoURL(n),e?t.preview(e):t.clearPreview()},t._updatePreviewTimeout=setTimeout(n,500)}}(this)),this._domInput.addEventListener("keypress",function(t){return function(e){return 13===e.keyCode?t.save():void 0}}(this)),this._domButton.addEventListener("click",function(t){return function(e){var n;return e.preventDefault(),n=t._domButton.getAttribute("class"),-1===n.indexOf("ct-control--muted")?t.save():void 0}}(this))},e}(ContentTools.DialogUI),o=function(t){function e(){e.__super__.constructor.call(this),this.history=null,this._state=ContentTools.EditorApp.DORMANT,this._regions=null,this._orderedRegions=null,this._rootLastModified=null,this._regionsLastModified={},this._ignition=null,this._inspector=null,this._toolbox=null}return s(e,t),e.prototype.ctrlDown=function(){return this._ctrlDown},e.prototype.domRegions=function(){return this._domRegions},e.prototype.orderedRegions=function(){var t;return function(){var e,n,o,i;for(o=this._orderedRegions,i=[],e=0,n=o.length;n>e;e++)t=o[e],i.push(this._regions[t]);return i}.call(this)},e.prototype.regions=function(){return this._regions},e.prototype.shiftDown=function(){return this._shiftDown},e.prototype.getState=function(){return this._state},e.prototype.isDormant=function(){return this._state===ContentTools.EditorApp.DORMANT},e.prototype.isReady=function(){return this._state===ContentTools.EditorApp.READY},e.prototype.isEditing=function(){return this._state===ContentTools.EditorApp.EDITING},e.prototype.busy=function(t){return this._ignition.busy(t)},e.prototype.init=function(t,e){return null==e&&(e="id"),this._namingProp=e,this._domRegions=t.length>0&&t[0].nodeType===Node.ELEMENT_NODE?t:document.querySelectorAll(t),0!==this._domRegions.length?(this.mount(),this._ignition=new ContentTools.IgnitionUI,this.attach(this._ignition),this._ignition.bind("start",function(t){return function(){return t.start()}}(this)),this._ignition.bind("stop",function(t){return function(e){var n;if(n=ContentEdit.Root.get().focused(),n&&void 0!==n._syncContent&&n._syncContent(),e)t.save();else if(!t.revert())return void t._ignition.changeState("editing");return t.stop()}}(this)),this._domRegions.length&&this._ignition.show(),this._toolbox=new ContentTools.ToolboxUI(ContentTools.DEFAULT_TOOLS),this.attach(this._toolbox),this._inspector=new ContentTools.InspectorUI,this.attach(this._inspector),this._state=ContentTools.EditorApp.READY,ContentEdit.Root.get().bind("detach",function(t){return function(){return t._preventEmptyRegions()}}(this)),ContentEdit.Root.get().bind("paste",function(t){return function(e,n){return t.paste(e,n.clipboardData)}}(this)),ContentEdit.Root.get().bind("next-region",function(t){return function(e){var n,o,i,r,s,a,l;if(r=t.orderedRegions(),i=r.indexOf(e),!(i>=r.length-1)){for(e=r[i+1],o=null,l=e.descendants(),s=0,a=l.length;a>s;s++)if(n=l[s],void 0!==n.content){o=n;break}return o?(o.focus(),void o.selection(new ContentSelect.Range(0,0))):ContentEdit.Root.get().trigger("next-region",e)}}}(this)),ContentEdit.Root.get().bind("previous-region",function(t){return function(e){var n,o,i,r,s,a,l,u;if(a=t.orderedRegions(),r=a.indexOf(e),!(0>=r)){for(e=a[r-1],i=null,o=e.descendants(),o.reverse(),l=0,u=o.length;u>l;l++)if(n=o[l],void 0!==n.content){i=n;break}return i?(s=i.content.length(),i.focus(),void i.selection(new ContentSelect.Range(s,s))):ContentEdit.Root.get().trigger("previous-region",e)}}}(this))):void 0},e.prototype.destroy=function(){return this.unmount()},e.prototype.highlightRegions=function(t){var e,n,o,i,r;for(i=this._domRegions,r=[],n=0,o=i.length;o>n;n++)e=i[n],r.push(t?ContentEdit.addCSSClass(e,"ct--highlight"):ContentEdit.removeCSSClass(e,"ct--highlight"));return r},e.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-app"]),document.body.insertBefore(this._domElement,null),this._addDOMEventListeners()},e.prototype.paste=function(t,e){var n,o,r,s,a,l,u,h,c,d,p,_,m,g,f,C,v,y,E,T,S,b;if(o=e.getData("text/plain"),g=o.split("\n"),g=g.filter(function(t){return""!==t.trim()})){if(s=HTMLString.String.encode,T=t.type(),(g.length>1||!t.content)&&"PreText"!==T){for("ListItemText"===T?(h=t.parent(),u=t.parent().parent(),l=u.children.indexOf(h)+1):(h=t,"Region"!==h.parent().type()&&(h=t.closest(function(t){return"Region"===t.parent().type()})),u=h.parent(),l=u.children.indexOf(h)+1),a=S=0,b=g.length;b>S;a=++S)_=g[a],_=s(_),"ListItemText"===T?(c=new ContentEdit.ListItem,d=new ContentEdit.ListItemText(_),c.attach(d),p=d):(c=new ContentEdit.Text("p",{},_),p=c),u.attach(c,l+a);return m=p.content.length(),p.focus(),p.selection(new ContentSelect.Range(m,m))}return o=s(o),o=new HTMLString.String(o,"PreText"===T),C=t.selection(),r=C.get()[0]+o.length(),E=t.content.substring(0,C.get()[0]),y=t.content.substring(C.get()[1]),f=t.content.substring(C.get()[0],C.get()[1]),f.length()&&(n=f.characters[0],v=n.tags(),n.isTag()&&v.shift(),v.length>=1&&(o=o.format.apply(o,[0,o.length()].concat(i.call(v))))),t.content=E.concat(o),t.content=t.content.concat(y,!1),t.updateInnerHTML(),t.taint(),C.set(r,r),t.selection(C)}},e.prototype.unmount=function(){return this.isMounted()?(this._domElement.parentNode.removeChild(this._domElement),this._domElement=null,this._removeDOMEventListeners(),this._ignition=null,this._inspector=null,this._toolbox=null):void 0},e.prototype.revert=function(){var t;return t=ContentEdit._("Your changes have not been saved, do you really want to lose them?"),ContentEdit.Root.get().lastModified()>this._rootLastModified&&!window.confirm(t)?!1:(this.revertToSnapshot(this.history.goTo(0),!1),!0)},e.prototype.revertToSnapshot=function(t,e){var n,o,i,r,s,a,l,u;null==e&&(e=!0),l=this._regions;for(i in l)r=l[i],r.domElement().innerHTML=t.regions[i];if(e){for(ContentEdit.Root.get().focused()&&ContentEdit.Root.get().focused().blur(),this._regions={},u=this._domRegions,o=s=0,a=u.length;a>s;o=++s)n=u[o],i=n.getAttribute(this._namingProp),i||(i=o),this._regions[i]=new ContentEdit.Region(n);return this.history.replaceRegions(this._regions),this.history.restoreSelection(t),this._inspector.updateTags()}},e.prototype.save=function(){var t,e,n,o,r,s,a,l,u;if(s=arguments[0],t=2<=arguments.length?i.call(arguments,1):[],l=ContentEdit.Root.get(),l.lastModified()!==this._rootLastModified||!s){o={},u=this._regions;for(r in u)a=u[r],n=a.html(),1===a.children.length&&(e=a.children[0],e.content&&!e.content.html()&&(n="")),s||(a.domElement().innerHTML=n),a.lastModified()!==this._regionsLastModified[r]&&(o[r]=n,this._regionsLastModified[r]=a.lastModified());return this.trigger.apply(this,["save",o].concat(i.call(t)))}},e.prototype.setRegionOrder=function(t){return this._orderedRegions=t.slice()},e.prototype.start=function(){var t,e,n,o,i,r;for(this.busy(!0),this._regions={},this._orderedRegions=[],r=this._domRegions,e=o=0,i=r.length;i>o;e=++o)t=r[e],n=t.getAttribute(this._namingProp),n||(n=e),this._regions[n]=new ContentEdit.Region(t),this._orderedRegions.push(n),this._regionsLastModified[n]=this._regions[n].lastModified();return this._preventEmptyRegions(),this._rootLastModified=ContentEdit.Root.get().lastModified(),this.history=new ContentTools.History(this._regions),this.history.watch(),this._state=ContentTools.EditorApp.EDITING,this._toolbox.show(),this._inspector.show(),this.busy(!1)},e.prototype.stop=function(){return ContentEdit.Root.get().focused()&&ContentEdit.Root.get().focused().blur(),this.history.stopWatching(),this.history=null,this._toolbox.hide(),this._inspector.hide(),this._regions={},this._state=ContentTools.EditorApp.READY},e.prototype._addDOMEventListeners=function(){return this._handleHighlightOn=function(t){return function(e){var n;if(17===(n=e.keyCode)||224===n)return void(t._ctrlDown=!0);if(16===e.keyCode){if(t._highlightTimeout)return;return t._shiftDown=!0,t._highlightTimeout=setTimeout(function(){return t.highlightRegions(!0)},ContentTools.HIGHLIGHT_HOLD_DURATION)}}}(this),this._handleHighlightOff=function(t){return function(e){var n;return 17===(n=e.keyCode)||224===n?void(t._ctrlDown=!1):16===e.keyCode?(t._shiftDown=!1,t._highlightTimeout&&(clearTimeout(t._highlightTimeout),t._highlightTimeout=null),t.highlightRegions(!1)):void 0}}(this),document.addEventListener("keydown",this._handleHighlightOn),document.addEventListener("keyup",this._handleHighlightOff),window.onbeforeunload=function(t){return function(){return t._state===ContentTools.EditorApp.EDITING?ContentEdit._("Your changes have not been saved, do you really want to lose them?"):void 0}}(this),window.addEventListener("unload",function(t){return function(){return t.destroy()}}(this))},e.prototype._preventEmptyRegions=function(){var t,e,n,o,i;o=this._regions,i=[];for(t in o)n=o[t],n.children.length>0||(e=new ContentEdit.Text("p",{},""),n.attach(e),i.push(n.commit()));return i},e.prototype._removeDOMEventListeners=function(){return document.removeEventListener("keydown",this._handleHighlightOn),document.removeEventListener("keyup",this._handleHighlightOff)},e}(ContentTools.ComponentUI),ContentTools.EditorApp=function(){function t(){}var e;return t.DORMANT="dormant",t.READY="ready",t.EDITING="editing",e=null,t.get=function(){var t;return t=ContentTools.EditorApp.getCls(),null!=e?e:e=new t},t.getCls=function(){return o},t}(),ContentTools.History=function(){function t(t){this._lastSnapshotTaken=null,this._regions={},this.replaceRegions(t),this._snapshotIndex=-1,this._snapshots=[],this._store()}return t.prototype.canRedo=function(){return this._snapshotIndex<this._snapshots.length-1},t.prototype.canUndo=function(){return this._snapshotIndex>0},t.prototype.index=function(){return this._snapshotIndex},t.prototype.length=function(){return this._snapshots.length},t.prototype.snapshot=function(){return this._snapshots[this._snapshotIndex]},t.prototype.goTo=function(t){return this._snapshotIndex=Math.min(this._snapshots.length-1,Math.max(0,t)),this.snapshot()},t.prototype.redo=function(){return this.goTo(this._snapshotIndex+1)},t.prototype.replaceRegions=function(t){var e,n,o;this._regions={},o=[];for(e in t)n=t[e],o.push(this._regions[e]=n);return o},t.prototype.restoreSelection=function(t){var e,n;return t.selected?(n=this._regions[t.selected.region],e=n.descendants()[t.selected.element],e.focus(),e.selection&&t.selected.selection?e.selection(t.selected.selection):void 0):void 0},t.prototype.stopWatching=function(){return this._watchInterval&&clearInterval(this._watchInterval),this._delayedStoreTimeout?clearTimeout(this._delayedStoreTimeout):void 0},t.prototype.undo=function(){return this.goTo(this._snapshotIndex-1)},t.prototype.watch=function(){var t;return this._lastSnapshotTaken=Date.now(),t=function(t){return function(){var e,n;if(n=ContentEdit.Root.get().lastModified(),null!==n&&n>t._lastSnapshotTaken){if(t._delayedStoreRequested===n)return;return t._delayedStoreTimeout&&clearTimeout(t._delayedStoreTimeout),e=function(){return t._lastSnapshotTaken=n,t._store()},t._delayedStoreRequested=n,t._delayedStoreTimeout=setTimeout(e,500)}}}(this),this._watchInterval=setInterval(t,50)},t.prototype._store=function(){var t,e,n,o,i,r,s;i={regions:{},selected:null},r=this._regions;for(e in r)o=r[e],i.regions[e]=o.html();if(t=ContentEdit.Root.get().focused()){if(i.selected={},o=t.closest(function(t){return"Region"===t.type()}),!o)return;s=this._regions;for(e in s)if(n=s[e],o===n){i.selected.region=e;break}i.selected.element=o.descendants().indexOf(t),t.selection&&(i.selected.selection=t.selection())}return this._snapshotIndex<this._snapshots.length-1&&(this._snapshots=this._snapshots.slice(0,this._snapshotIndex+1)),this._snapshotIndex++,this._snapshots.splice(this._snapshotIndex,0,i)},t}(),ContentTools.StylePalette=function(){function t(){}return t._styles=[],t.add=function(t){return this._styles=this._styles.concat(t)},t.styles=function(t){return void 0===t?this._styles.slice():this._styles.filter(function(e){return e._applicableTo?-1!==e._applicableTo.indexOf(t):!0})},t}(),ContentTools.Style=function(){function t(t,e,n){this._name=t,this._cssClass=e,this._applicableTo=n?n:null}return t.prototype.applicableTo=function(){return this._applicableTo},t.prototype.cssClass=function(){return this._cssClass},t.prototype.name=function(){return this._name},t}(),ContentTools.ToolShelf=function(){function t(){}return t._tools={},t.stow=function(t,e){return this._tools[e]=t},t.fetch=function(t){if(!this._tools[t])throw new Error("`"+t+"` has not been stowed on the tool shelf");return this._tools[t]},t}(),ContentTools.Tool=function(){function t(){}return t.label="Tool",t.icon="tool",t.requiresElement=!0,t.canApply=function(){return!1},t.isApplied=function(){return!1},t.apply=function(){throw new Error("Not implemented")},t._insertAt=function(t){var e,n;return n=t,"Region"!==n.parent().type()&&(n=t.closest(function(t){return"Region"===t.parent().type()})),e=n.parent().children.indexOf(n)+1,[n,e]},t}(),ContentTools.Tools.Bold=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"bold"),e.label="Bold",e.icon="bold",e.tagName="b",e.canApply=function(t,e){return t.content?e&&!e.isCollapsed():!1},e.isApplied=function(t,e){var n,o,i;return void 0!==t.content&&t.content.length()?(i=e.get(),n=i[0],o=i[1],n===o&&(o+=1),t.content.slice(n,o).hasTags(this.tagName,!0)):!1},e.apply=function(t,e,n){var o,i,r;return t.storeState(),r=e.get(),o=r[0],i=r[1],t.content=this.isApplied(t,e)?t.content.unformat(o,i,new HTMLString.Tag(this.tagName)):t.content.format(o,i,new HTMLString.Tag(this.tagName)),t.content.optimize(),t.updateInnerHTML(),t.taint(),t.restoreState(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.Italic=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"italic"),e.label="Italic",e.icon="italic",e.tagName="i",e}(ContentTools.Tools.Bold),ContentTools.Tools.Link=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"link"),e.label="Link",e.icon="link",e.tagName="a",e.getAttr=function(t,e,n){var o,i,r,s,a,l,u,h,c,d,p,_;if("Image"===e.type()){if(e.a)return e.a[t]}else for(d=n.get(),i=d[0],a=d[1],r=e.content.slice(i,a),p=r.characters,l=0,h=p.length;h>l;l++)if(o=p[l],o.hasTags("a"))for(_=o.tags(),u=0,c=_.length;c>u;u++)if(s=_[u],"a"===s.name())return s.attr(t);return""},e.canApply=function(t,e){var n;return"Image"===t.type()?!0:t.content&&e&&(!e.isCollapsed()||(n=t.content.characters[e.get()[0]],n&&n.hasTags("a")))?!0:!1},e.isApplied=function(t,n){return"Image"===t.type()?t.a:e.__super__.constructor.isApplied.call(this,t,n)},e.apply=function(t,e,n){var o,i,r,s,a,l,u,h,c,d,p,_,m,g,f,C;if(r=!1,"Image"===t.type())p=t.domElement().getBoundingClientRect();else{if(e.isCollapsed()){for(s=t.content.characters,m=e.get(0)[0],u=m;m>0&&s[m-1].hasTags("a");)m-=1;for(;u<s.length&&s[u].hasTags("a");)u+=1;e=new ContentSelect.Range(m,u),e.select(t.domElement())}t.storeState(),_=new HTMLString.Tag("span",{"class":"ct--puesdo-select"}),C=e.get(),h=C[0],g=C[1],t.content=t.content.format(h,g,_),t.updateInnerHTML(),l=t.domElement(),c=l.getElementsByClassName("ct--puesdo-select"),p=c[0].getBoundingClientRect()}return i=ContentTools.EditorApp.get(),d=new ContentTools.ModalUI(f=!0,o=!0),d.bind("click",function(){return this.unmount(),a.hide(),t.content&&(t.content=t.content.unformat(h,g,_),t.updateInnerHTML(),t.restoreState()),n(r)}),a=new ContentTools.LinkDialog(this.getAttr("href",t,e),this.getAttr("target",t,e)),a.position([p.left+p.width/2+window.scrollX,p.top+p.height/2+window.scrollY]),a.bind("save",function(e){var n,o,i,s,l,u,c,p;if(a.unbind("save"),r=!0,"Image"===t.type()){if(o=["align-center","align-left","align-right"],e.href){for(t.a={href:e.href,target:e.target?e.target:"","class":t.a?t.a["class"]:""},l=0,c=o.length;c>l;l++)if(i=o[l],t.hasCSSClass(i)){t.removeCSSClass(i),t.a["class"]=i;break}}else{for(s=[],t.a["class"]&&(s=t.a["class"].split(" ")),u=0,p=o.length;p>u;u++)if(i=o[u],s.indexOf(i)>-1){t.addCSSClass(i);break}t.a=null}t.unmount(),t.mount()}else t.content=t.content.unformat(h,g,"a"),e.href&&(n=new HTMLString.Tag("a",e),t.content=t.content.format(h,g,n),t.content.optimize()),t.updateInnerHTML();return t.taint(),d.trigger("click")}),i.attach(d),i.attach(a),d.show(),a.show()},e}(ContentTools.Tools.Bold),ContentTools.Tools.Heading=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"heading"),e.label="Heading",e.icon="heading",e.tagName="h1",e.canApply=function(t){return void 0!==t.content&&-1!==["Text","PreText"].indexOf(t.type())},e.isApplied=function(t){return t.content?-1===["Text","PreText"].indexOf(t.type())?!1:t.tagName()===this.tagName:!1},e.apply=function(t,e,n){var o,i,r,s;return t.storeState(),"PreText"===t.type()?(o=t.content.html().replace(/&nbsp;/g," "),s=new ContentEdit.Text(this.tagName,{},o),r=t.parent(),i=r.children.indexOf(t),r.detach(t),r.attach(s,i),t.blur(),s.focus(),s.selection(e)):(t.tagName(t.tagName()===this.tagName?"p":this.tagName),t.restoreState()),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.Subheading=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"subheading"),e.label="Subheading",e.icon="subheading",e.tagName="h2",e}(ContentTools.Tools.Heading),ContentTools.Tools.Paragraph=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"paragraph"),e.label="Paragraph",e.icon="paragraph",e.tagName="p",e.canApply=function(t){return void 0!==t},e.apply=function(t,n,o){var i,r,s,a;return i=ContentTools.EditorApp.get(),r=i.ctrlDown(),ContentTools.Tools.Heading.canApply(t)&&!r?e.__super__.constructor.apply.call(this,t,n,o):("Region"!==t.parent().type()&&(t=t.closest(function(t){return"Region"===t.parent().type()})),a=t.parent(),s=new ContentEdit.Text("p"),a.attach(s,a.children.indexOf(t)+1),s.focus(),o(!0))},e}(ContentTools.Tools.Heading),ContentTools.Tools.Preformatted=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"preformatted"),e.label="Preformatted",e.icon="preformatted",e.tagName="pre",e.apply=function(t,e,n){var o,i,r,s;return"PreText"===t.type()?void ContentTools.Tools.Paragraph.apply(t,e,n):(s=t.content.text(),r=new ContentEdit.PreText("pre",{},HTMLString.String.encode(s)),i=t.parent(),o=i.children.indexOf(t),i.detach(t),i.attach(r,o),t.blur(),r.focus(),r.selection(e),n(!0))},e}(ContentTools.Tools.Heading),ContentTools.Tools.AlignLeft=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"align-left"),e.label="Align left",e.icon="align-left",e.className="text-left",e.canApply=function(t){return void 0!==t.content},e.isApplied=function(t){var e;return this.canApply(t)?(("ListItemText"===(e=t.type())||"TableCellText"===e)&&(t=t.parent()),t.hasCSSClass(this.className)):!1},e.apply=function(t,e,n){var o,i,r,s,a;for(("ListItemText"===(s=t.type())||"TableCellText"===s)&&(t=t.parent()),a=["text-center","text-left","text-right"],i=0,r=a.length;r>i;i++)if(o=a[i],t.hasCSSClass(o)&&(t.removeCSSClass(o),o===this.className))return n(!0);return t.addCSSClass(this.className),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.AlignCenter=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"align-center"),e.label="Align center",e.icon="align-center",e.className="text-center",e}(ContentTools.Tools.AlignLeft),ContentTools.Tools.AlignRight=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"align-right"),e.label="Align right",e.icon="align-right",e.className="text-right",e}(ContentTools.Tools.AlignLeft),ContentTools.Tools.UnorderedList=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"unordered-list"),e.label="Bullet list",e.icon="unordered-list",e.listTag="ul",e.canApply=function(t){var e;return void 0!==t.content&&("Region"===(e=t.parent().type())||"ListItem"===e)},e.apply=function(t,e,n){var o,i,r,s,a;return"ListItem"===t.parent().type()?(t.storeState(),i=t.closest(function(t){return"List"===t.type()}),i.tagName(this.listTag),t.restoreState()):(s=new ContentEdit.ListItemText(t.content.copy()),r=new ContentEdit.ListItem,r.attach(s),i=new ContentEdit.List(this.listTag,{}),i.attach(r),a=t.parent(),o=a.children.indexOf(t),a.detach(t),a.attach(i,o),s.focus(),s.selection(e)),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.OrderedList=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"ordered-list"),e.label="Numbers list",e.icon="ordered-list",e.listTag="ol",e}(ContentTools.Tools.UnorderedList),ContentTools.Tools.Table=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"table"),e.label="Table",e.icon="table",e.canApply=function(t){return void 0!==t},e.apply=function(t,e,n){var o,i,r,s;return t.storeState&&t.storeState(),o=ContentTools.EditorApp.get(),r=new ContentTools.ModalUI,s=t.closest(function(t){return t&&"Table"===t.type()}),i=new ContentTools.TableDialog(s),i.bind("cancel",function(){return function(){return i.unbind("cancel"),r.hide(),i.hide(),t.restoreState&&t.restoreState(),n(!1)}}(this)),i.bind("save",function(e){return function(o){var a,l,u,h;return i.unbind("save"),l=!0,s?(e._updateTable(o,s),l=t.closest(function(t){return t&&"Table"===t.type()})):(s=e._createTable(o),h=e._insertAt(t),u=h[0],a=h[1],u.parent().attach(s,a),l=!1),l?t.restoreState():s.firstSection().children[0].children[0].children[0].focus(),r.hide(),i.hide(),n(!0)}}(this)),o.attach(r),o.attach(i),r.show(),i.show()},e._adjustColumns=function(t,e){var n,o,i,r,s,a,l,u,h,c,d;for(c=t.children,d=[],u=0,h=c.length;h>u;u++)l=c[u],o=l.children[0].tagName(),r=l.children.length,s=e-r,d.push(0>s?function(){var t,e;for(e=[],a=t=s;0>=s?0>t:t>0;a=0>=s?++t:--t)n=l.children[l.children.length-1],e.push(l.detach(n));return e}():s>0?function(){var t,e;for(e=[],a=t=0;s>=0?s>t:t>s;a=s>=0?++t:--t)n=new ContentEdit.TableCell(o),l.attach(n),i=new ContentEdit.TableCellText(""),e.push(n.attach(i));return e}():void 0);return d},e._createTable=function(t){var e,n,o,i;return i=new ContentEdit.Table,t.head&&(o=this._createTableSection("thead","th",t.columns),i.attach(o)),e=this._createTableSection("tbody","td",t.columns),i.attach(e),t.foot&&(n=this._createTableSection("tfoot","td",t.columns),i.attach(n)),i},e._createTableSection=function(t,e,n){var o,i,r,s,a,l;for(a=new ContentEdit.TableSection(t),s=new ContentEdit.TableRow,a.attach(s),r=l=0;n>=0?n>l:l>n;r=n>=0?++l:--l)o=new ContentEdit.TableCell(e),s.attach(o),i=new ContentEdit.TableCellText(""),o.attach(i);return a},e._updateTable=function(t,e){var n,o,i,r,s,a,l;if(!t.head&&e.thead()&&e.detach(e.thead()),!t.foot&&e.tfoot()&&e.detach(e.tfoot()),n=e.firstSection().children[0].children.length,t.columns!==n)for(l=e.children,s=0,a=l.length;a>s;s++)r=l[s],this._adjustColumns(r,t.columns);return t.head&&!e.thead()&&(i=this._createTableSection("thead","th",t.columns),e.attach(i)),t.foot&&!e.tfoot()?(o=this._createTableSection("tfoot","td",t.columns),e.attach(o)):void 0},e}(ContentTools.Tool),ContentTools.Tools.Indent=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"indent"),e.label="Indent",e.icon="indent",e.canApply=function(t){return"ListItem"===t.parent().type()&&t.parent().parent().children.indexOf(t.parent())>0},e.apply=function(t,e,n){return t.parent().indent(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.Unindent=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"unindent"),e.label="Unindent",e.icon="unindent",e.canApply=function(t){return"ListItem"===t.parent().type()},e.apply=function(t,e,n){return t.parent().unindent(),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.LineBreak=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"line-break"),e.label="Line break",e.icon="line-break",e.canApply=function(t){return t.content},e.apply=function(t,e,n){var o,i,r,s;return i=e.get()[0]+1,s=t.content.substring(0,e.get()[0]),r=t.content.substring(e.get()[1]),o=new HTMLString.String("<br>",t.content.preserveWhitespace()),t.content=s.concat(o,r),t.updateInnerHTML(),t.taint(),e.set(i,i),t.selection(e),n(!0)},e}(ContentTools.Tool),ContentTools.Tools.Image=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"image"),e.label="Image",e.icon="image",e.canApply=function(){return!0},e.apply=function(t,e,n){var o,i,r;return t.storeState&&t.storeState(),o=ContentTools.EditorApp.get(),r=new ContentTools.ModalUI,i=new ContentTools.ImageDialog,i.bind("cancel",function(){return function(){return i.unbind("cancel"),r.hide(),i.hide(),t.restoreState&&t.restoreState(),n(!1)}}(this)),i.bind("save",function(e){return function(o,s,a){var l,u,h,c;return i.unbind("save"),a||(a={}),a.height=s[1],a.src=o,a.width=s[0],l=new ContentEdit.Image(a),c=e._insertAt(t),h=c[0],u=c[1],h.parent().attach(l,u),l.focus(),r.hide(),i.hide(),n(!0)}}(this)),o.attach(r),o.attach(i),r.show(),i.show()},e}(ContentTools.Tool),ContentTools.Tools.Video=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"video"),e.label="Video",e.icon="video",e.canApply=function(){return!0},e.apply=function(t,e,n){var o,i,r;return t.storeState&&t.storeState(),o=ContentTools.EditorApp.get(),r=new ContentTools.ModalUI,i=new ContentTools.VideoDialog,i.bind("cancel",function(){return function(){return i.unbind("cancel"),r.hide(),i.hide(),t.restoreState&&t.restoreState(),n(!1)}}(this)),i.bind("save",function(e){return function(o){var s,a,l,u;return i.unbind("save"),o?(l=new ContentEdit.Video("iframe",{frameborder:0,height:ContentTools.DEFAULT_VIDEO_HEIGHT,src:o,width:ContentTools.DEFAULT_VIDEO_WIDTH}),u=e._insertAt(t),a=u[0],s=u[1],a.parent().attach(l,s),l.focus()):t.restoreState&&t.restoreState(),r.hide(),i.hide(),n(""!==o)}}(this)),o.attach(r),o.attach(i),r.show(),i.show()},e}(ContentTools.Tool),ContentTools.Tools.Undo=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"undo"),e.label="Undo",e.icon="undo",e.requiresElement=!1,e.canApply=function(){var t;return t=ContentTools.EditorApp.get(),t.history&&t.history.canUndo()},e.apply=function(){var t,e;return t=ContentTools.EditorApp.get(),t.history.stopWatching(),e=t.history.undo(),t.revertToSnapshot(e),t.history.watch()},e}(ContentTools.Tool),ContentTools.Tools.Redo=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),ContentTools.ToolShelf.stow(e,"redo"),e.label="Redo",e.icon="redo",e.requiresElement=!1,e.canApply=function(){var t;return t=ContentTools.EditorApp.get(),t.history&&t.history.canRedo()},e.apply=function(){var t,e;return t=ContentTools.EditorApp.get(),t.history.stopWatching(),e=t.history.redo(),t.revertToSnapshot(e),t.history.watch()},e}(ContentTools.Tool),ContentTools.Tools.Remove=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),
ContentTools.ToolShelf.stow(e,"remove"),e.label="Remove",e.icon="remove",e.canApply=function(){return!0},e.apply=function(t,e,n){var o,i,r,s;switch(o=ContentTools.EditorApp.get(),t.blur(),t.nextContent()?t.nextContent().focus():t.previousContent()&&t.previousContent().focus(),t.type()){case"ListItemText":o.ctrlDown()?(i=t.closest(function(t){return"Region"===t.parent().type()}),i.parent().detach(i)):t.parent().parent().detach(t.parent());break;case"TableCellText":o.ctrlDown()?(s=t.closest(function(t){return"Table"===t.type()}),s.parent().detach(s)):(r=t.parent().parent(),r.parent().detach(r));break;default:t.parent().detach(t)}return n(!0)},e}(ContentTools.Tool)}.call(this);